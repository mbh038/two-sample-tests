<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Michael Hunt">
<title>Tests for difference: two sample t-test</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="tests_for_difference_files/libs/clipboard/clipboard.min.js"></script>
<script src="tests_for_difference_files/libs/quarto-html/quarto.js"></script>
<script src="tests_for_difference_files/libs/quarto-html/popper.min.js"></script>
<script src="tests_for_difference_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="tests_for_difference_files/libs/quarto-html/anchor.min.js"></script>
<link href="tests_for_difference_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="tests_for_difference_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="tests_for_difference_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="tests_for_difference_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="tests_for_difference_files/libs/bootstrap/bootstrap-4bba5e2a3696111c7f0c20ecb83df5d3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script src="tests_for_difference_files/libs/quarto-diagram/mermaid.min.js"></script><script src="tests_for_difference_files/libs/quarto-diagram/mermaid-init.js"></script><link href="tests_for_difference_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#test-finder-flow-chart" id="toc-test-finder-flow-chart" class="nav-link active" data-scroll-target="#test-finder-flow-chart">Test finder flow chart</a></li>
  <li>
<a href="#two-sample-t-test-the-parametric-case" id="toc-two-sample-t-test-the-parametric-case" class="nav-link" data-scroll-target="#two-sample-t-test-the-parametric-case">Two sample t-test: the parametric case</a>
  <ul class="collapse">
<li><a href="#when-to-use-the-two-sample-t-test" id="toc-when-to-use-the-two-sample-t-test" class="nav-link" data-scroll-target="#when-to-use-the-two-sample-t-test">When to use the two-sample <em>t</em>-test</a></li>
  <li>
<a href="#motivation-and-example" id="toc-motivation-and-example" class="nav-link" data-scroll-target="#motivation-and-example">Motivation and example</a>
  <ul class="collapse">
<li><a href="#questions-and-hypotheses" id="toc-questions-and-hypotheses" class="nav-link" data-scroll-target="#questions-and-hypotheses">Questions and hypotheses</a></li>
  </ul>
</li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The data</a></li>
  <li>
<a href="#the-process" id="toc-the-process" class="nav-link" data-scroll-target="#the-process">The Process</a>
  <ul class="collapse">
<li><a href="#step-one-summarise-the-data" id="toc-step-one-summarise-the-data" class="nav-link" data-scroll-target="#step-one-summarise-the-data">Step One: Summarise the data</a></li>
  <li><a href="#step-two-plot-the-data" id="toc-step-two-plot-the-data" class="nav-link" data-scroll-target="#step-two-plot-the-data">Step Two: Plot the data</a></li>
  <li><a href="#step-three-check-the-validity-of-the-data---are-the-data-normally-distributed" id="toc-step-three-check-the-validity-of-the-data---are-the-data-normally-distributed" class="nav-link" data-scroll-target="#step-three-check-the-validity-of-the-data---are-the-data-normally-distributed">Step Three: Check the validity of the data - are the data normally distributed?</a></li>
  <li><a href="#do-the-actual-two-sample-t-test" id="toc-do-the-actual-two-sample-t-test" class="nav-link" data-scroll-target="#do-the-actual-two-sample-t-test">Do the actual two-sample <em>t</em>-test</a></li>
  <li><a href="#interpret-the-output-of-the-t-test." id="toc-interpret-the-output-of-the-t-test." class="nav-link" data-scroll-target="#interpret-the-output-of-the-t-test.">Interpret the output of the <em>t</em>-test.</a></li>
  </ul>
</li>
  <li>
<a href="#other-examples-where-a-two-sample-t-test-might-be-used." id="toc-other-examples-where-a-two-sample-t-test-might-be-used." class="nav-link" data-scroll-target="#other-examples-where-a-two-sample-t-test-might-be-used.">Other examples where a two sample <em>t</em>-test might be used.</a>
  <ul class="collapse">
<li><a href="#can-you-think-of-examples-of-where-you-might-use-a-two-sample-t-test" id="toc-can-you-think-of-examples-of-where-you-might-use-a-two-sample-t-test" class="nav-link" data-scroll-target="#can-you-think-of-examples-of-where-you-might-use-a-two-sample-t-test">Can you think of examples of where you might use a two-sample <em>t</em>-test?</a></li>
  </ul>
</li>
  <li><a href="#what-if-i-cant-use-a-two-sample-t-test" id="toc-what-if-i-cant-use-a-two-sample-t-test" class="nav-link" data-scroll-target="#what-if-i-cant-use-a-two-sample-t-test">What if I can’t use a two sample <em>t</em>-test?</a></li>
  </ul>
</li>
  <li>
<a href="#the-non-parametric-case" id="toc-the-non-parametric-case" class="nav-link" data-scroll-target="#the-non-parametric-case">The non-parametric case</a>
  <ul class="collapse">
<li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  <li>
<a href="#script" id="toc-script" class="nav-link" data-scroll-target="#script">Script</a>
  <ul class="collapse">
<li><a href="#load-packages" id="toc-load-packages" class="nav-link" data-scroll-target="#load-packages">Load packages</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load data</a></li>
  <li><a href="#summarise-the-data" id="toc-summarise-the-data" class="nav-link" data-scroll-target="#summarise-the-data">Summarise the data</a></li>
  <li><a href="#plot-the-data" id="toc-plot-the-data" class="nav-link" data-scroll-target="#plot-the-data">Plot the data</a></li>
  <li><a href="#wilcoxon-mann-whitney-u-test" id="toc-wilcoxon-mann-whitney-u-test" class="nav-link" data-scroll-target="#wilcoxon-mann-whitney-u-test">Wilcoxon-Mann-Whitney U test</a></li>
  </ul>
</li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  <li><a href="#when-should-i-use-this-wilcoxon-mann-whitney-u-test" id="toc-when-should-i-use-this-wilcoxon-mann-whitney-u-test" class="nav-link" data-scroll-target="#when-should-i-use-this-wilcoxon-mann-whitney-u-test">When should I use this Wilcoxon-Mann-Whitney U test?</a></li>
  <li><a href="#hang-on" id="toc-hang-on" class="nav-link" data-scroll-target="#hang-on">Hang on!</a></li>
  </ul>
</li>
  <li>
<a href="#paired-data" id="toc-paired-data" class="nav-link" data-scroll-target="#paired-data">Paired data</a>
  <ul class="collapse">
<li>
<a href="#which-test-paired-t-test-or-wilcoxon-signed-rank-test" id="toc-which-test-paired-t-test-or-wilcoxon-signed-rank-test" class="nav-link" data-scroll-target="#which-test-paired-t-test-or-wilcoxon-signed-rank-test">Which test: paired t-test or Wilcoxon signed rank test?</a>
  <ul class="collapse">
<li><a href="#the-paired-t-test" id="toc-the-paired-t-test" class="nav-link" data-scroll-target="#the-paired-t-test">The paired t-test</a></li>
  <li><a href="#the-wilcoxon-signed-rank-test" id="toc-the-wilcoxon-signed-rank-test" class="nav-link" data-scroll-target="#the-wilcoxon-signed-rank-test">The Wilcoxon Signed Rank test</a></li>
  <li><a href="#null-hypotheses" id="toc-null-hypotheses" class="nav-link" data-scroll-target="#null-hypotheses">Null Hypotheses</a></li>
  <li><a href="#test-output" id="toc-test-output" class="nav-link" data-scroll-target="#test-output">Test output</a></li>
  </ul>
</li>
  <li>
<a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">Example</a>
  <ul class="collapse">
<li><a href="#two-sample-paired-t-test" id="toc-two-sample-paired-t-test" class="nav-link" data-scroll-target="#two-sample-paired-t-test">Two sample paired t-test</a></li>
  </ul>
</li>
  <li><a href="#the-non-parametric-alternative-the-wilcoxon-signed-rank-test" id="toc-the-non-parametric-alternative-the-wilcoxon-signed-rank-test" class="nav-link" data-scroll-target="#the-non-parametric-alternative-the-wilcoxon-signed-rank-test">The non-parametric alternative: The Wilcoxon signed rank test</a></li>
  <li><a href="#relation-to-one-sample-paired-test" id="toc-relation-to-one-sample-paired-test" class="nav-link" data-scroll-target="#relation-to-one-sample-paired-test">Relation to one-sample paired test</a></li>
  </ul>
</li>
  </ul><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="tests_for_difference.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Tests for difference: two sample <em>t</em>-test</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Michael Hunt </p>
          </div>
  </div>
    
  
    
  </div>
  


</header><p>In this document we consider tests for difference where there are two levels being compared.</p>
<section id="test-finder-flow-chart" class="level1"><h1>Test finder flow chart</h1>
<p>First, use this flowchart to see if a two-sample t-test or its non-parametric counterpart the Mann-Whitney-U test is appropriate for your question, your study design and your data:</p>
<div class="cell" data-layout-align="default">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>flowchart TD</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  A{Difference or Trend \nQuestion?} --&gt; B[Trend]</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  B --&gt; B2{Are you testing for \ndegree of association\nor are you trying \nto make predictions?}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  B2 --&gt; B33[Association:\n\nTest for\n correlation coefficient\nPearson or \n Spearman's Rank]</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  B2 --&gt; B44[Predictions:\n\nSimple linear regression]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  A --&gt; C[Difference]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  C --&gt; C22{Do you have replicates?}</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  C22 --&gt; C22Y[Yes]</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  C22 --&gt; C22N[No]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  C22N --&gt; C23{Do you have count data?}</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  C23 --&gt; C23Y[Yes]</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  C23 --&gt; C23N[N0]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  C23Y --&gt; C24(Chi square test:\nGoodness of fit\nor\nTest of independence)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  C23N --&gt; C25[These data cannot be analysed]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  C22Y --&gt; D{How many factors?}</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  D --&gt; F[Two or more]</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  F --&gt; F2{Independent\nsamples?}</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  F2 --&gt; F2Y[Yes]</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  F2 --&gt; F2N[No]</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  F2Y --&gt; F22Y(n-way ANOVA)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  F2N --&gt; F22N(n-way\nrepeated measures\nANOVA)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  D --&gt; E[One]</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  E --&gt; G{How many levels?}</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  G --&gt; H[Two]</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  G --&gt; I[More than two]</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  I --&gt; J{Independent\n samples?}</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  J --&gt; K[No]</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  J --&gt; L[Yes]</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  K --&gt; S(Repeated measures one-way ANOVA\nor\nFriedman Test)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  L --&gt; T(One way ANOVA\nor\nKruskal Wallis one-way test)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  H --&gt; M{Independent\n samples?}</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  M --&gt; N[No]</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  M --&gt; O[Yes]</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  N --&gt; P(paired t-test\nor\nSigned rank test)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  O --&gt; Q(two sample t-test\nor\nMatt Whitney U test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<p></p><figure class="figure"></figure><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
  A{Difference or Trend \nQuestion?} --&gt; B[Trend]
  B --&gt; B2{Are you testing for \ndegree of association\nor are you trying \nto make predictions?}
  B2 --&gt; B33[Association:\n\nTest for\n correlation coefficient\nPearson or \n Spearman's Rank]
  B2 --&gt; B44[Predictions:\n\nSimple linear regression]
  A --&gt; C[Difference]
  C --&gt; C22{Do you have replicates?}
  C22 --&gt; C22Y[Yes]
  C22 --&gt; C22N[No]
  C22N --&gt; C23{Do you have count data?}
  C23 --&gt; C23Y[Yes]
  C23 --&gt; C23N[N0]
  C23Y --&gt; C24(Chi square test:\nGoodness of fit\nor\nTest of independence)
  C23N --&gt; C25[These data cannot be analysed]
  C22Y --&gt; D{How many factors?}
  D --&gt; F[Two or more]
  F --&gt; F2{Independent\nsamples?}
  F2 --&gt; F2Y[Yes]
  F2 --&gt; F2N[No]
  F2Y --&gt; F22Y(n-way ANOVA)
  F2N --&gt; F22N(n-way\nrepeated measures\nANOVA)
  D --&gt; E[One]
  E --&gt; G{How many levels?}
  G --&gt; H[Two]
  G --&gt; I[More than two]
  I --&gt; J{Independent\n samples?}
  J --&gt; K[No]
  J --&gt; L[Yes]
  K --&gt; S(Repeated measures one-way ANOVA\nor\nFriedman Test)
  L --&gt; T(One way ANOVA\nor\nKruskal Wallis one-way test)
  H --&gt; M{Independent\n samples?}
  M --&gt; N[No]
  M --&gt; O[Yes]
  N --&gt; P(paired t-test\nor\nSigned rank test)
  O --&gt; Q(two sample t-test\nor\nMatt Whitney U test)
  
</pre>
</div>
<p></p>
</div>
</div>
</div>
<p>If this chart suggests you need something other than the two sample t-test or Mann-Whitney test, you need to go to the descriptions of that test.</p>
</section><section id="two-sample-t-test-the-parametric-case" class="level1"><h1>Two sample t-test: the parametric case</h1>
<p>In this exercise we find out how to run a two-sample <em>t</em>-test, to determine whether there is evidence to reject the hypothesis that two samples are drawn from the same population.</p>
<section id="when-to-use-the-two-sample-t-test" class="level2"><h2 class="anchored" data-anchor-id="when-to-use-the-two-sample-t-test">When to use the two-sample <em>t</em>-test</h2>
<ul>
<li>
<p>It can be used when we have two independent samples of <strong>numerical</strong> (not ordinal) response data, and our question is whether the data provide evidence that the samples are drawn from different populations. Even when this criterion is met and the data are numerical and independent, the normality criterion described below still needs to be met. That apart, two common examples where we have two sets of data but we should not use the two sample <em>t</em>-test are:</p>
<ul>
<li><p>If the data in your two samples are not independent because you have measured the same individual replicate before and after some event or treatment, then you should probably be using a <strong>paired <em>t</em>-test</strong> instead. In this you don’t have two samples, each comprising a separate and independent set of replicates. Instead, you have multiple pairs of values, one pair per replicate. The replicates are still assumed to be independent of each other</p></li>
<li><p>If your response data are the answers to a Likert scale such as might be used in a survey then they are <em>ordinal</em> in nature and not numerical, and you should probably be using the non-parametric equivalent of the two sample <em>t</em>-test, which is variously known as the <strong>Wilcoxon Rank Sum test</strong> or as the <strong>Mann Whitney U test</strong>, or its paired sample version, if appropriate.</p></li>
</ul>
</li>
<li><p>It can be used when the data set is small. But not so small that there are no replicates. You <strong>do</strong> need replicates.</p></li>
<li><p>It can still be used when the data set is large.</p></li>
<li><p>It assumes that the data are drawn from a normally distributed population. There are various ways to test if this is plausibly the case, and you should try at least one of them, but with small samples, just where the <em>t</em>-test is most useful, it can be difficult to tell. In the end we can also appeal to reason: is there good reason to suppose that the data would or would not be normally distributed?</p></li>
<li><p>When comparing the means of two samples, both samples should in principle have the same variance, which is a measure of the spread of the data, so in principle you need to check that this is at least <em>approximately</em> the case, or have reason to suppose that it should be. <em>However</em>, in an actual <em>t</em>-test done using R, the Welch variant of the <em>t</em>-test is carried out by default. This works even when the variances of the two sets are different, so in practice it is possible to ignore this equal variance requirement.</p></li>
<li><p>We only use it when we are comparing two samples, one for each of the two levels of a single factor. When we have samples for more than two levels and we use the <em>t</em>-test to look for a difference between any two of them, it becomes increasingly likely, the more pairs of samples we compare, that we will decide that we have found a difference because we got a <em>p</em>-value that was less than some pre-determined threshold (which could be anything, but is most often chosen to be 0.05) even if in reality there is none. This is the problem of high false positive rates arising from multiple pairwise testing and is where ANOVA comes in. <em>t</em>-tests are only used to detect evidence for a difference between two groups, not more. ANOVAs (or their non-parametric equivalent) are used when we are looking for differences between more than two groups.</p></li>
</ul></section><section id="motivation-and-example" class="level2"><h2 class="anchored" data-anchor-id="motivation-and-example">Motivation and example</h2>
<p>In our example we will consider the impact of pesticide use on the masses of shells of garden snails (<em>Cornu aspersum</em>), as measured in gardens around a city, ten from randomly selected gardens that have used a range of pesticides for at least two years and ten that are from randomly selected gardens that have not ever used pesticides. We leave aside here the issue of how those gardens were identified and how randomisation was ensured.</p>
<section id="questions-and-hypotheses" class="level3"><h3 class="anchored" data-anchor-id="questions-and-hypotheses">Questions and hypotheses</h3>
<p>Our <strong>question</strong> is:</p>
<p><em>Is there evidence for a difference between snail shell masses in the gardens where pesticides were used compared to those where they were not used?</em></p>
<p>From which a suitable <strong>null hypothesis</strong> is:</p>
<p><em>There is no difference between shell masses in the gardens, whether or not pesticides were used.</em></p>
<p>and a suitable <strong>alternate, two-sided hypothesis</strong> is:</p>
<p><em>There is a difference between shell masses.</em></p>
</section></section><section id="the-data" class="level2"><h2 class="anchored" data-anchor-id="the-data">The data</h2>
<p>Suppose we had our data arranged in a spreadsheet in three columns, one giving the garden ID, G1 to G20, one telling us whether pesticides were used in the garden, yes or no, and one telling us the masses in grams of the snail shells from each garden. Afficioados of R will see that this is ‘tidy’ data. Each variable (ID, pesticide use, shell mass) occurs in only one column, rather than being spread across several. It turns out that this way of storing your data makes it much easier to analyse.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># there should be a 'garden_snails.csv' file in your data folder</span></span>
<span></span>
<span><span class="va">filepath</span><span class="op">&lt;-</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>,<span class="st">"garden_snails.csv"</span><span class="op">)</span></span>
<span><span class="va">snails</span><span class="op">&lt;-</span><span class="fu">read_csv</span><span class="op">(</span><span class="va">filepath</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># if not, you should be able to get it from Mike's github repo</span></span>
<span></span>
<span><span class="co"># file_url &lt;- "https://raw.githubusercontent.com/mbh038/r-workshop/refs/heads/gh-pages/data/garden_snails.csv"</span></span>
<span><span class="co"># snails&lt;-read_csv(file_url)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">snails</span>,<span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 3
   garden.ID pesticide shell_mass_g
   &lt;chr&gt;     &lt;chr&gt;            &lt;dbl&gt;
 1 S1        Yes               1.37
 2 S2        Yes               1.15
 3 S3        Yes               0.73
 4 S4        Yes               0.65
 5 S5        Yes               1.03
 6 S6        Yes               1.8 
 7 S7        Yes               1.21
 8 S8        Yes               1.41
 9 S9        Yes               1.27
10 S10       Yes               1.08
11 S11       No                2   
12 S12       No                3.99
13 S13       No                1.99
14 S14       No                1.75
15 S15       No                2.81
16 S16       No                2.15
17 S17       No                1.87
18 S18       No                3.46
19 S19       No                2.8 
20 S20       No                2.89</code></pre>
</div>
</div>
<ul>
<li>Is this a tidy data set?</li>
<li>Is the data in the <code>pesticide</code> column categorical?</li>
<li>If so, how many levels does it have and what are they?</li>
</ul></section><section id="the-process" class="level2"><h2 class="anchored" data-anchor-id="the-process">The Process</h2>
<section id="step-one-summarise-the-data" class="level3"><h3 class="anchored" data-anchor-id="step-one-summarise-the-data">Step One: Summarise the data</h3>
<p>With numerical data spread across more than one level of a categorical variable, we often want summary information such as mean values and standard errors of the mean for each level.</p>
<p>Here we will calculate the number of replicates, the mean and the standard error of the mean for both levels of <code>pesticide</code> ie Yes and No:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">snail.summary</span><span class="op">&lt;-</span> <span class="va">snails</span> <span class="op">|&gt;</span></span>
<span><span class="fu">group_by</span><span class="op">(</span><span class="va">pesticide</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span><span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          mean.mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">shell_mass_g</span><span class="op">)</span>,</span>
<span>          se.mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">shell_mass_g</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">snail.summary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  pesticide     n mean.mass se.mass
  &lt;chr&gt;     &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 No           10      2.57   0.236
2 Yes          10      1.17   0.105</code></pre>
</div>
</div>
<p>From these data, does it look as though there is evidence for a difference between shell masses in the two types of garden? Clearly, the snails in the ten gardens that did not use pesticide had a higher mean shell mass than the ten from gardens that did use pesticide. But is this a fluke? How precisely do we think these sample means reflect the truth about the impact of the use of pesticides? That is what the standard error column tells us. You can think of the standard error as being an estimate of how far our sample means, drawn from just ten gardens of each type are likely to differ from the true shell masses for all gardens that did use pesticides and all gardens that did not.</p>
<p>Bottom line: the difference between the sample means is about ten times the size of the standard errors of each. It really does look as though snails shells in gardens where pesticides are not used are indeed heavier than in gardens where pesticides are used.</p>
</section><section id="step-two-plot-the-data" class="level3"><h3 class="anchored" data-anchor-id="step-two-plot-the-data">Step Two: Plot the data</h3>
<p>Remember, before we do any statistical analysis, it is almost always a good idea to plot the data in some way. We can often get a very good idea as to the answer to our research question just from the plots we do.</p>
<p>In <a href="#fig-histograms" class="quarto-xref">Figure&nbsp;1</a>, we will use <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> in R to plot a histogram of ozone levels, one for each side of the city. We will stack the histograms one above the other, all the better to help us spot any differences between east and west.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">snails</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">shell_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth<span class="op">=</span><span class="fl">0.2</span>,fill<span class="op">=</span><span class="st">"darkred"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">pesticide</span>,ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-histograms" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-histograms-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="tests_for_difference_files/figure-html/fig-histograms-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histograms-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Stacked histograms
</figcaption></figure>
</div>
</div>
</div>
<p>Instead of histograms, we could have drawn box plots, as in:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">snails</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">pesticide</span>,y<span class="op">=</span><span class="va">shell_mass_g</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Pestice use?"</span>,</span>
<span>       y<span class="op">=</span><span class="st">"Shell mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-boxplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="tests_for_difference_files/figure-html/fig-boxplot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Side-byside box and whisker plots of the distribution of values in each snail sample. The lower and upper edges of each box show the 25th and 75th percentiles of each sample, and the thick black line between them shows the median value ie the 50th percentile
</figcaption></figure>
</div>
</div>
</div>
<p>or as a dot plot of the means with standard errors of the mean included as error bars, as in <a href="#fig-means-se" class="quarto-xref">Figure&nbsp;3</a></p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># for this chart we will use the summary table that we created above.</span></span>
<span></span>
<span><span class="va">snail.summary</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">pesticide</span>,y<span class="op">=</span><span class="va">mean.mass</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin<span class="op">=</span><span class="va">mean.mass</span><span class="op">-</span><span class="va">se.mass</span>,ymax<span class="op">=</span><span class="va">mean.mass</span><span class="op">+</span><span class="va">se.mass</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="co"># try leaving this line out. What happens? Which is better?</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Pesticide use?"</span>,</span>
<span>       y<span class="op">=</span><span class="st">"Shell mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-means-se" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-means-se-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="tests_for_difference_files/figure-html/fig-means-se-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-means-se-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: The data points show mean values, the error bars show plus or minus one standard error of the mean
</figcaption></figure>
</div>
</div>
</div>
<ul>
<li><p>Do the data look as though they are inconsistent with the null hypothesis ?</p></li>
<li><p>In addition, do the data look as though each group is drawn from a normally distributed population? One of the types of graphs gives you no indication of that while the other two do. Which is the odd one out? Even when looking at the other two figures, when there are so few data it’s kind of hard to tell, no?</p></li>
</ul>
<p>Let’s now do some stats.</p>
</section><section id="step-three-check-the-validity-of-the-data---are-the-data-normally-distributed" class="level3"><h3 class="anchored" data-anchor-id="step-three-check-the-validity-of-the-data---are-the-data-normally-distributed">Step Three: Check the validity of the data - are the data normally distributed?</h3>
<p>We can go about establishing this in three ways: using an analytical test of normality, using a graphical method and by thinking about what kind of data we have. Let’s consider these in turn.</p>
<section id="normality-test---analytical-method" class="level4"><h4 class="anchored" data-anchor-id="normality-test---analytical-method">Normality test - analytical method</h4>
<p>There are several analytical tests one can run on a set of data to determine if it is plausible that it has been drawn from a normally distributed population. One is the Shapiro-Wilk test.</p>
<p>For more information on the Shapiro-Wilk test in R, type <code><a href="https://rdrr.io/r/stats/shapiro.test.html">?shapiro.test</a></code> into the console window. For kicks, try it out on the examples that appear in the help window (which is the bottom right pane, Help tab). One example is testing a sample of data that explicitly <em>is</em> drawn from a normal distribution, the other tests a sample of data that definitely <em>is not</em>. What <em>p</em>-value do you get in each case? How closely do the histograms of each sample resemble a normal distribution?</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#first we create a data frame containing the two example data sets</span></span>
<span><span class="va">example1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">500</span>, mean <span class="op">=</span> <span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co"># first example from the help pane</span></span>
<span><span class="va">example2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">500</span>, min <span class="op">=</span> <span class="fl">2</span>, max <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="co"># second example from the help pane</span></span>
<span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu">tibble</span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">example1</span>,<span class="va">example2</span><span class="op">)</span>, distribution<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"example 1: normal"</span>,<span class="fl">500</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"example 2: not at all normal"</span>,<span class="fl">500</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># then we plot a histogram of each data set</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span>,<span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>bins<span class="op">=</span><span class="fl">20</span>,fill<span class="op">=</span><span class="st">"cornflowerblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">distribution</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="tests_for_difference_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># and finally we run a Shapiro-Wilk normality test on each data set</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/shapiro.test.html">shapiro.test</a></span><span class="op">(</span><span class="va">example1</span><span class="op">)</span> <span class="co"># 100 samples drawn from a normally distributed population</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  example1
W = 0.99673, p-value = 0.4101</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/shapiro.test.html">shapiro.test</a></span><span class="op">(</span><span class="va">example2</span><span class="op">)</span> <span class="co"># 100 samples drawn from a uniformly (ie NOT normally) distributed population</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  example2
W = 0.95787, p-value = 9.254e-11</code></pre>
</div>
</div>
<p>For the examples above, we see that Shapiro-Wilk test gave a high <em>p</em>-value for the data that we knew <em>were</em> drawn from a normal distribution, and a very low <em>p</em>-value for the data that we knew were not.</p>
<p>The Shapiro-Wilk test tests your data against the null hypothesis that it is drawn from a normally distributed population. It gives a <em>p</em>-value which, as always, is the probably of you having data as far from normality, or further, as yours are if the null hypothesis were true. If the <em>p</em>-value is less than 0.05 then we reject the null hypothesis and cannot suppose our data is drawn froma normally distributed population. In that case we would have to ditch the <em>t</em>-test for a difference, and choose another difference test in its place that could cope with data that was not normally distributed. For a two-sample <em>t</em>-test such as we are hoping to use here, the so-called non-parametric alternative that we could use instead is the Wilcoxon Rank Sum test, often called the Mann-Whitney U test.</p>
<p>Why don’t we do that in the first place, I hear you ask? Why bother with this finicky <em>t</em>-test that requires that we go through the faff of testing the data for normality before we can use it? The answer is that it is more powerful than other, so-called non-parametric tests that <em>can</em> cope with non-normal data. It is more likely than they are to spot a difference if there really is a difference. So if we can use it, that is what we would rather do.</p>
<p>So, onwards, let’s do the Shapiro-Wilk test on our data</p>
<p>We want to test each garden group for normality, so we group the data by location as before and and then summarise, this time asking for the <em>p</em>-value returned by the Shapiro-Wilk test of normality.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">snails</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">pesticide</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span><span class="st">'Shapiro-Wilk p-value'</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/shapiro.test.html">shapiro.test</a></span><span class="op">(</span><span class="va">shell_mass_g</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  pesticide `Shapiro-Wilk p-value`
  &lt;chr&gt;                      &lt;dbl&gt;
1 No                         0.223
2 Yes                        0.854</code></pre>
</div>
</div>
<p>For both groups the <em>p</em>-value is more than 0.05, so at the 5% significance level we cannot reject the null hypothesis that the data are normally distributed, so we can go on and use the <em>t</em>-test. Yay!</p>
</section><section id="graphical-methods---the-quantile-quantile-or-qq-plot." class="level4"><h4 class="anchored" data-anchor-id="graphical-methods---the-quantile-quantile-or-qq-plot.">Graphical methods - the quantile-quantile or QQ plot.</h4>
<p>Confession: I don’t normally bother with numerical tests for normality such as Shapiro-Wilk. I usually use a graphical method instead.</p>
<p>We have already seen two ways of plotting the data that might help suggest whether it is plausible that the data are drawn from normally distributed populations. Histograms and box plots both indicate how data is distributed, and for normally distributed data both would be symmetrical. Well, they would be, more or less, if the data set was large enough but for small data sets it can be quite hard to tell from either type of plot whether the data are drawn from a normally distributed population.</p>
<p>A better type of plot for making this judgement call is the quantile-quantile or ‘qq’ plot which basically compares the distribution of your data to that of a normal distribution. If your data are approximately normally distributed then a qq plot will give a straight(-ish) line. Even with small data sets, this is usually easy to spot.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">snails</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>sample<span class="op">=</span><span class="va">shell_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_qq</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_qq_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">pesticide</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="tests_for_difference_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Nothing outrageously non-linear there, so that also suggests we can safely use the <em>t</em>-test.</p>
<p>For an overview of how normally distributed and non-normally distributed data looks when plotted in histograms, box plots and quantile-quantile plots, see <a href="https://rpubs.com/mbh038/725314">this review</a></p>
</section><section id="the-thinking-about-the-data-normality-test" class="level4"><h4 class="anchored" data-anchor-id="the-thinking-about-the-data-normality-test">The ‘thinking about the data’ normality test</h4>
<p>As you might have guessed, this isn’t a test as such, but a suggestion that you think about what kind of data you have: is it likely to be normally distributed within its subgroups or not? If the data are numerical values of some physical quantity that is the result of many independent processes, and if the data are not bounded on either side (say by 0 and 100 as for exam scores) then it is quite likely that that they are. If they are count data, or ordinal data, then it is quite likely that they are not.</p>
<p>This way of thinking may be all you can do when data sets are very small and any of the more robus<em>t</em> tests for normality presented here leave you not much the wiser.</p>
</section></section><section id="do-the-actual-two-sample-t-test" class="level3"><h3 class="anchored" data-anchor-id="do-the-actual-two-sample-t-test">Do the actual two-sample <em>t</em>-test</h3>
<p>So, it looks as though it is plausible that the data are drawn from normal distributions. That means we can go on to use a parametric test such as a two sample <em>t</em>-test and have confidence in its output.</p>
<p>If we were doing this in R we could use the <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code> function for this (other functions are available!). This needs to be given a formula and a data set as arguments. Look up <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code> in R’s help documentation, and see if you can get the <em>t</em>-test to tell you whether there is a significant difference between ozone levels in the east and in the west of the city.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">shell_mass_g</span><span class="op">~</span><span class="va">pesticide</span>,data<span class="op">=</span><span class="va">snails</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  shell_mass_g by pesticide
t = 5.4172, df = 12.442, p-value = 0.0001372
alternative hypothesis: true difference in means between group No and group Yes is not equal to 0
95 percent confidence interval:
 0.8397234 1.9622766
sample estimates:
 mean in group No mean in group Yes 
            2.571             1.170 </code></pre>
</div>
</div>
</section><section id="interpret-the-output-of-the-t-test." class="level3"><h3 class="anchored" data-anchor-id="interpret-the-output-of-the-t-test.">Interpret the output of the <em>t</em>-test.</h3>
<p>Study the output of the <em>t</em>-test. Here are some questions to ask yourself.</p>
<ul>
<li>What kind of test was carried out?
<ul>
<li><em>A Welch two sample t-test</em></li>
</ul>
</li>
<li>What data was used for the test?
<ul>
<li><em>The snail shell mass in g (the output variable) and pesticide use (the explanatory variable)</em></li>
</ul>
</li>
<li>What is the test statistic of the data?
<ul>
<li><em>This is t = 5.4172.</em></li>
</ul>
</li>
<li>How many degrees of freedom were there? This number is the number of independent pices of information that were used to calculate the final result. It is usually one, two, or three or so less than the number of data points. Don’t overthink it at this stage, especially not the fact that here it is not an integer.
<ul>
<li><em>df = 12.442</em></li>
</ul>
</li>
<li>What is the p-value?
<ul>
<li><em>p = 0.0001372. You would most likely report this as p &lt; 0.001</em></li>
</ul>
</li>
<li>What does the p value mean?
<ul>
<li><em>It is the likelihood of seeing a difference between sample means as large or larger than the one we found if in fact pesticides made no difference to snail shell mass.</em></li>
</ul>
</li>
<li>What is the confidence interval for the difference between shell masses in gardens that use pesticides and in gardens that do not? Does it encompass zero? Remember that the confidence interval gives the range of values within which the true difference between mean shell masses might reasonably lie, given the data. If that range includes zero then the test is telling is that zero is a plausible value for the difference, and hence that we cannot reject the null hypothesis.
<ul>
<li><em>The 95% confidence interval has lower bound 0.8397 and upper bound 1.962. This range does not encompass zero.</em></li>
</ul>
</li>
<li>Is there sufficient evidence to reject the null hypothesis?
<ul>
<li><em>Yes. We see this in two way. First the p value is much less than 0.05 and second, the 95% confidence interval does not encompass zero. In a way, the confidence interval is giving us more information than the p-value, since not only can we deduce whether there is evidence for a significant difference, we can also see how big that difference is and how precisely we know it.</em></li>
</ul>
</li>
<li>What does the word ‘Welch’ tell you - Google it or look it up in the help for <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code>.
<ul>
<li><em>It tells us that a variant of the t-test is being used in which it does not matter if the two. samples have difference variances (spreads).</em></li>
</ul>
</li>
</ul></section></section><section id="other-examples-where-a-two-sample-t-test-might-be-used." class="level2"><h2 class="anchored" data-anchor-id="other-examples-where-a-two-sample-t-test-might-be-used.">Other examples where a two sample <em>t</em>-test might be used.</h2>
<p>Remember that <em>t</em>-tests in general are used when you have independent samples with multiple replicates drawn from populations corresponding to <strong>two</strong> levels of some factor (eg north coast, south coast; this beach, that beach; polluted place, clean place etc) and you have measured something numerical, like a length or a mass, temperature or concentration. You still have to do the tests for normality described above, but these are the basic criteria.</p>
<section id="can-you-think-of-examples-of-where-you-might-use-a-two-sample-t-test" class="level3"><h3 class="anchored" data-anchor-id="can-you-think-of-examples-of-where-you-might-use-a-two-sample-t-test">Can you think of examples of where you might use a two-sample <em>t</em>-test?</h3>
<p>Here are a few suggestions:</p>
<ul>
<li><p>Is there a difference between the flight initiation distance of redstarts when confronted by dogs compared to when they are confronted by drones?</p></li>
<li><p>Is the nitrate concentration of water in a river below a beaver dam different from the nitrate content above that dam?</p></li>
</ul>
<p>Can you think of another example?</p>
</section></section><section id="what-if-i-cant-use-a-two-sample-t-test" class="level2"><h2 class="anchored" data-anchor-id="what-if-i-cant-use-a-two-sample-t-test">What if I can’t use a two sample <em>t</em>-test?</h2>
<ul>
<li><p>Assuming you have two independent samples, this might be because one or both sets failed the normality criterion, or your data are ordinal. In that case the likely alternative is the <strong>non-parametric</strong> equivalent of the <em>t</em>-test, variously known as the Wilcoxon Rank Sum test or the Mann Whitney U test.</p></li>
<li><p>If your data are in fact sets of <strong>paired values</strong>, for example because you measured some attribute of the same individuals before and after some treatment, or at two points in time, then you need to use the paired <em>t</em>-test.</p></li>
<li><p>If you only have <strong>one sample</strong> of replicates and want to compare its mean value to a threshold, then you use a one sample t-test. You might do this, for example, if you had collected sediment samples from an estuary, measured the concentration in those samples of some pollutant such as pathogens from sewage, or phosphates from farm runoff, and then wanted to see if the water was compliant with water quality thresholds as dictated by, say, the Water Framework Directive.</p></li>
</ul></section></section><section id="the-non-parametric-case" class="level1"><h1>The non-parametric case</h1>
<p>A common scenario is that we have two sets of measurements, and we want to see if there is evidence that they are drawn from different populations. For some data types we can use a <em>t</em>-test to do this, but for others we cannot.</p>
<p>A <em>t</em>-test requires in particular that the two sets of data are normally distributed around their respective means. With <em>ordinal</em> data this makes no sense. The mean is undefined as a concept for such data.</p>
<p>To see this , reflect that for a collection <span class="math inline">\(X\)</span> of numerical data, say, 5, 3, 3, 4, and 5 we would calculate the mean as:</p>
<p><span class="math display">\[
\bar{X} = \frac{5+3+3+4+5}{5} = \frac{20}{5}=4
\]</span></p>
<p>But trying doing the same to five responses of a Likert scale survey. Say the responses you had to five Likert items (individual questions) were “strongly disagree”, “strongly agree”, “mildly disagree”, “strongly disagree” and “don’t care either way”. If you tried to calculate a ‘mean’ response you would be attempting to add up all these responses and to divide the ‘sum’ by five, like this:</p>
<p><span class="math display">\[\text{mean response}=\frac{\text{stongly disagree}+\text{strongly agree}+\text{mildly disagree}+\text{stongly disagree}+\text{don't care either way}}{5} = ?
\]</span> This sum makes no sense, I hope you will agree. It makes no sense, not because we are using words to describe our responses, but because, as these are ordinal data, we do not know the size of the gaps between the different points on the scale. Is the difference in agreement between the lowest two, “strongly disagree” and “midly disagree” the same as the gap between the highest two, “mildly agree” and “strongly agree”? We don’t know, mainly because ‘agreement’ is not something that can be measured easily using something like a weighing machine. And if we don’t know, then we shouldn’t really be adding these responses up or dividing them by anything.</p>
<p>Nevertheless, ordinal data are very common, since they are typically what is generated by survey data, where for example repondents may answer a series of questions (‘items’), each with typically five possible responses, but maybe more or fewer, these responses being ordinal in the sense that there is a definite order to them. They might encompass responses like those above, say, or something similar like “very unhappy” to “very happy”. They are also common in clinical and veterinary practice where ordinal pain scores are widely used - patients being asked (if they are human) or assessed as to their level of pain on a scale of 1-10, for example. Note that even if the pain value is recorded as a number it is actually a label, that could just as well have been recorded as one of a series of letters, A, B, C etc or emojis, or any symbol you like. You can’t take the average of a set of faces!</p>
<p>Thus, formally, we need another kind of test for a difference. Broadly, we need to use some form of <em>non-parametric</em> test where we do not assume that the data has any form of distribution, and where, often, we do not use the actual values of the measurements in our dataset but instead use only their <em>ranks</em>. The smallest value would be given rank 1, the next rank 2 and so on.</p>
<p>There are many non-parametric tests out there. Here we will look at only one - the <strong>Wilcoxon Rank Sum Test</strong>, often referred to as a <strong>Mann-Whitney U</strong> test for a difference. We can use this for the scenario we have painted above, where we have two sets of data and we wish to know if these provide evidence that the populations from which the samples have been drawn are in fact different.</p>
<section id="example" class="level2"><h2 class="anchored" data-anchor-id="example">Example</h2>
<p>This example uses actual data gathered by an Honours Project student.</p>
<p>The student wished to assess peoples’ sense of wellbeing using two different sets of questions designed to assess this. The scales chosen were the Warwick–Edinburgh Mental Well-being Scale (WEMWBS) and the New Ecological Paradigm (NEP) Scale. The student wished in particular to determine whether this sense of well-being was affected by whether a person often and actively frequented the coast and made it and the sea a substantive part of their life in one way or another. ie to find out whether there was evidence to support the notion that it could be good for your mental wellbeing to be by the sea and to make it part of your life.</p>
<p>Each scale used consists of 15 questions or ‘Likert items’, each of which is answered on a 5 point ordinal scale, where a score of 1 indicates lowest wellbeing and a score of 5 indicates highest wellbeing. Thus each respondent could score anything from 15 to 75.</p>
<p>The student got responses from 374 people, 86 of whom were not “marine” users, while the other 288 say that they <em>were</em> marine users. The total scores from each respondent were recorded for each type of survey and stored in the file <code>wellness.csv</code> which you should find on the module Moodle site / Teams page. Please put this file in the <code>data</code> folder of your R project.</p>
</section><section id="script" class="level2"><h2 class="anchored" data-anchor-id="script">Script</h2>
<p>The first few chunks of this script carry out the same old-same old that we see in script after script: load packages, load data, summarise data , plot data.</p>
<p>You can run this script by running each chunk in sequence, which you do by clicking the green arrow in the top-right corner of each chunk.</p>
<p>Try also to ‘Knit’ the script by clicking on the Knit button at the top of the script pane.</p>
<p>If you want to create your own script to use with your own data then you can copy and paste into it any code chunks that would be of use and adapt them as necessary.</p>
<section id="load-packages" class="level3"><h3 class="anchored" data-anchor-id="load-packages">Load packages</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="load-data" class="level3"><h3 class="anchored" data-anchor-id="load-data">Load data</h3>
<p>Our data set is in a <code>.csv</code> file which we have placed in the data folder within our project folder.</p>
<p>Note that this data set has been stored in ‘tidy’ form: each variable appears in only column, and each observation appears in only one row.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filepath</span><span class="op">&lt;-</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>,<span class="st">"wellness.csv"</span><span class="op">)</span></span>
<span><span class="va">wellness</span><span class="op">&lt;-</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">filepath</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">wellness</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 748
Columns: 4
$ id          &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,…
$ scale       &lt;chr&gt; "WEMWBS", "WEMWBS", "WEMWBS", "WEMWBS", "WEMWBS", "WEMWBS"…
$ marine      &lt;chr&gt; "Yes", "No", "No", "No", "Yes", "Yes", "Yes", "No", "Yes",…
$ total_score &lt;dbl&gt; 48, 51, 37, 39, 38, 40, 54, 39, 54, 39, 51, 50, 49, 51, 54…</code></pre>
</div>
</div>
</section><section id="summarise-the-data" class="level3"><h3 class="anchored" data-anchor-id="summarise-the-data">Summarise the data</h3>
<p>We’ll calculate the median score (50th percentile) and the 25th and 75th percentile scores. For ordinal data, these summary statistics are well defined, whereas means and standard deviations are not.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wellness</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">scale</span>,<span class="va">marine</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>median.score<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">total_score</span><span class="op">)</span>,iqr_25<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">total_score</span>,<span class="fl">0.25</span><span class="op">)</span>,iqr_75<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">total_score</span>,<span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
# Groups:   scale [2]
  scale  marine median.score iqr_25 iqr_75
  &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 WEMWBS No             42.5   36       49
2 WEMWBS Yes            47     41       51
3 nep    No             51     48.2     53
4 nep    Yes            50     48       53</code></pre>
</div>
</div>
</section><section id="plot-the-data" class="level3"><h3 class="anchored" data-anchor-id="plot-the-data">Plot the data</h3>
<p>Box plots are particularly suitable for ordinal data since they show the 25th and 75th percentiles of the data (the bottom and top of the box) plus the 50th percentile aka the median, which is the thick line across each box. All of these percentiles are well defined quantities for ordinal data.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wellness</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">scale</span>,y <span class="op">=</span> <span class="va">total_score</span>,fill <span class="op">=</span> <span class="va">marine</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Likert Scale"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Wellbeing Score"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="tests_for_difference_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Looking at the plot, what do you think each scale suggests about whether proximity to the sea makes a difference to wellbeing?</p>
</section><section id="wilcoxon-mann-whitney-u-test" class="level3"><h3 class="anchored" data-anchor-id="wilcoxon-mann-whitney-u-test">Wilcoxon-Mann-Whitney U test</h3>
<p>First let’s pull out the scores as measured by the WEMWBS scale and do a test for a difference between the scores of marine users and those of non-marine users. We can use the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function to do this.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WEMWBS</span><span class="op">&lt;-</span><span class="va">wellness</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">scale</span><span class="op">==</span><span class="st">"WEMWBS"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test</a></span><span class="op">(</span><span class="va">total_score</span><span class="op">~</span><span class="va">marine</span>,data<span class="op">=</span><span class="va">WEMWBS</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  total_score by marine
W = 9077.5, p-value = 0.0001687
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<p>The null hypothesis of this test is that there is no evidence that the data are drawn from different populations. In this case, the <em>p</em>-value is very small, so we can confidently reject that null hypothesis and assert that there is evidence, according to the WEMWBS scale that marine use makes a difference to peoples’ sense of wellbeing.</p>
<p>Does it make it worse or better? - we can see from the summary table and from the box plot that higher scores are associated with those people who were exposed to a marine environment.</p>
<p>We might report this results as follows, first using a plain English statement of the main finding, and then reporting the type of test use, the value of the test statistci that it calculated and the p value. In this case, because the p value is so small, we would not report its exact value, but simle give an indication of how small it is:</p>
<p>We find evidence, according to the WEMWBS scale, that the wellbeing score is 4.5 or about 10% higher for people exposed to a marine environment (Mann-Whitney U, W = 9077.5, p &lt; 0.001).</p>
</section></section><section id="exercise" class="level2"><h2 class="anchored" data-anchor-id="exercise">Exercise</h2>
<p>Adapt the code of the last chunk so that you can do the same test but for data as recorded by the nep scale</p>
</section><section id="when-should-i-use-this-wilcoxon-mann-whitney-u-test" class="level2"><h2 class="anchored" data-anchor-id="when-should-i-use-this-wilcoxon-mann-whitney-u-test">When should I use this Wilcoxon-Mann-Whitney U test?</h2>
<p>The test we have used here is an example of a <em>non-parametric</em> test. This means that it does not assume that the data follow a known mathematical distribution and, further, that it can be used with ordinal data.</p>
<p>We used the Mann-Whitney U test in particular because we were testing for a difference, and because the factor of interest - marine exposure - had just two levels - Yes or No.&nbsp;This test is only suitable when there are just two levels, so you can think of it as as a non-parametric alternative to a t-test.</p>
<p>In another setting where we still had just one factor (eg zone of a rocky shore) but there were more than two levels (eg low, mid and high zones of the shore) and we decided that we wanted to do a non-parametric test for a difference, then we would probably use the Kruskal-Wallis test, which you can think of as the non-parametric alternative to a one-way ANOVA.</p>
<p>In this example we used the Mann-Whitney U test because the data were ordinal and thus not suitable to use with a parametric test (but see below!). Where we can, we usually try to use a parametric test as they are more powerful than their non-parametric equivalents, meaning, if there is a trend or a difference in the data, they are better able to detect it. However those parametric tests (t-test, ANOVA, pearson correlation, PCA, GLM to name but a few) typically require not only that the data are numerical but also a host of other things, including that they follow a particular distribution, usually (but not always) the normal distribution, and this is often not the case with real biological data. Often, especially with count data, there are lots of zeros, or the data distribution is heavily skewed, usually to the right. In these cases, providing the data are independent of each other, we can usually still use a non-parametric test such as we have here. it might not be the most powerful test we can use (GLMs are typically way better if you can use them), but it will work.</p>
</section><section id="hang-on" class="level2"><h2 class="anchored" data-anchor-id="hang-on">Hang on!</h2>
<p>The eagle eyed among you may have spotted a massive flaw in the line of argument presented above. We said that ordinal data can’t be added up, can’t be used to calculate averages and so on. Thus we can’t run parametric tests on them and have to look for alternatives, namely, non-parametric tests.</p>
<p>And yet, these non-parametric tests are usually run on the output of Likert <em>scales</em> such as we have considered here, where for each person we have a number of Likert <em>Items</em> (ie individual questions) that together constitute the <em>scale</em>, that each generate a score 1-5, then we <em>add up the scores</em> to get a total score. But that means we are adding up ordinal data!!!</p>
<p>It turns out that you actually get much the same results with Likert scale data if you analyse them using supposedly inappropriate parametric tests such as a 2-sample <em>t</em>-test as you do if you use a non-parametric test such as the one we considered here, the Mann-Whitney test.</p>
<p>A study by De Winter and Dodou (2010) shows this convincingly.</p>
<p>de Winter, J. F. C., &amp; Dodou, D. (2010). Five-Point Likert Items: t test versus Mann-Whitney-Wilcoxon (Addendum added October 2012). Practical Assessment, Research, and Evaluation,15, 1–16. https://doi.org/10.7275/bj1p-ts64</p>
<p>For an enlightening discussion of this paper, see <a href="https://statisticsbyjim.com/hypothesis-testing/analyze-likert-scale-data/">this blog by Jim Frost</a></p>
</section></section><section id="paired-data" class="level1"><h1>Paired data</h1>
<p>Often one has a sample of replicated data where each element has a counterpart in another matched sample - paired data. A common scenario for this is when there are data for the same individual at two different points in time, for example before and after some event such as the application of a treatment.</p>
<p>In order to determine whether there is a difference between the two sets, one should take the paired aspect into account and not simply match the whole before-set against the whole after-set without doing this. That would be to throw away the information whereby there is likely to be a greater degree of correlation between the responses of an individual before and after the event than there is between any randomly chosen pairs of individuals before and after the event.</p>
<section id="which-test-paired-t-test-or-wilcoxon-signed-rank-test" class="level2"><h2 class="anchored" data-anchor-id="which-test-paired-t-test-or-wilcoxon-signed-rank-test">Which test: paired t-test or Wilcoxon signed rank test?</h2>
<p>There is a choice between at least two tests: the parametric paired t-test and the non-parametric Wilcoxon signed rank test. Ideally one would use the t-test since it is more powerful than the Wilcoxon test. This means several things, but in particular it means that, all else being equal, it can detect a small difference with higher probability than the Wilcoxon test can.</p>
<section id="the-paired-t-test" class="level3"><h3 class="anchored" data-anchor-id="the-paired-t-test">The paired t-test</h3>
<p>Where the data are numerical (ie not ordinal) and where the before and after data are both normally distributed around their respective mean values one would use the <em>paired t-test</em> in this scenario. One can test for normality using either a test such as the Shapiro-Wilk test, or graphically using either a histogram, a box plot, or (best), a quantile-quantile plot.</p>
</section><section id="the-wilcoxon-signed-rank-test" class="level3"><h3 class="anchored" data-anchor-id="the-wilcoxon-signed-rank-test">The Wilcoxon Signed Rank test</h3>
<p>The t-test, an example of a so-called parametric test, is actually pretty robust against departures from normality, but where one doubts its validity due to extreme non-normality or for other reasons such as the ordinal nature of the data, the Wilcoxon signed rank test is a useful non-parametric alternative. It is called non-parametric because it does not make any assumption about the distribution of the data values. It only uses their ranks, where the smallest value gets rank 1, the next smallest gets rank 2, and so on.</p>
<p>So, you typically use this test when you would like to use the paired t-test, but you cannot because one or both of the data sets is way off being normally distributed or is ordinal.</p>
</section><section id="null-hypotheses" class="level3"><h3 class="anchored" data-anchor-id="null-hypotheses">Null Hypotheses</h3>
<p>In both the t-test and the Wilcoxon signed rank tests, the null hypothesis is the usual ‘nothing going on’, ‘there is no difference’ scenario, but there is a subtle difference between them that reflects the different information that they use. In the Wilcoxon signed rank test the null is that the difference between the <em>medians</em> of pairs of observations is zero. This is different from the null hypothesis of the paired t–test, which is that the difference between the <em>means</em> of pairs is zero.</p>
</section><section id="test-output" class="level3"><h3 class="anchored" data-anchor-id="test-output">Test output</h3>
<p>Both tests will give a p value. This is the probability that the mean (t-test) or median (Wilcoxon signed rank) paired differences between the corresponding before and after sample elements would be equal to or greater than it actually is for the data if the null hypothesis were true. If the p value is less than some pre-decided ‘significance level’, usually taken to be 0.05, then we reject the null hypothesis. If it is not, then we fail to reject the null hypothesis.</p>
</section></section><section id="example-1" class="level2"><h2 class="anchored" data-anchor-id="example-1">Example</h2>
<p>We will use as an example a data set from Laureysens et al.&nbsp;(2004) that has measurements of metal content in the wood of 13 poplar clones growing in a polluted area, once from each clone in August and once again from each of them in November. The idea was to investigate the extent to which poplars could absorb metals from the soil and thus be useful in cleaning that up. Under a null hypothesis, there would be no change in the metal concentrations in the plant tissue of each clone between August and November. Under an alternate hypothesis, there would be.</p>
<p>Laureysens, I. et al.&nbsp;(2004) ‘Clonal variation in heavy metal accumulation and biomass production in a poplar coppice culture: I. Seasonal variation in leaf, wood and bark concentrations’, Environmental Pollution, 131(3), pp.&nbsp;485–494. Available at: https://doi.org/10.1016/j.envpol.2004.02.009.</p>
<p>Concentrations of aluminum (in micrograms of Al per gram of wood) are shown below.</p>
<p><strong>Load packages</strong></p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span> <span class="co"># to make the plots look nice</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Load data</strong></p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>,<span class="st">"poplars-paired_np.csv"</span><span class="op">)</span></span>
<span><span class="va">poplars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">filepath</span>,show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">poplars</span>,<span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 4
      ID Clone          August November
   &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;
 1     1 Balsam_Spire      8.1     11.2
 2     2 Beaupre          10       16.3
 3     3 Hazendans        16.5     15.3
 4     4 Hoogvorst        13.6     15.6
 5     5 Raspalje          9.5     10.5
 6     6 Unal              8.3     15.5
 7     7 Columbia_River   18.3     12.7
 8     8 Fritzi_Pauley    13.3     11.1
 9     9 Trichobel         7.9     19.9
10    10 Gaver             8.1     20.4
11    11 Gibecq            8.9     14.2
12    12 Primo            12.6     12.7
13    13 Wolterson        13.4     36.8</code></pre>
</div>
</div>
<p><strong>Plot the data</strong></p>
<p>Before we do any test on some data to find evidence for a difference or a trend, it is a good idea to plot the data. This will reveal whatever patterns there are in the data and how likely they are to reveal a truth about the population from which they have been drawn.</p>
<p><strong>Tidy the data</strong></p>
<p>In this case there is work to do before we can plot the data. The problem is that the data is ‘untidy’. The two levels of the factor <code>month</code> are spread across two columns, August and November. For plotting purposes it will be useful to ‘tidy’ the data so that there is only one column containing both levels of <code>month</code> and another containing the aluminium concentrations. The function <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> can do this for us:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poplars_tidy</span> <span class="op">&lt;-</span> <span class="va">poplars</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span> <span class="op">(</span><span class="va">August</span><span class="op">:</span><span class="va">November</span>,names_to<span class="op">=</span><span class="st">"month"</span>,values_to<span class="op">=</span><span class="st">"Al_conc"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">poplars_tidy</span>,<span class="fl">8</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">gt</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="jdzxnayued" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#jdzxnayued table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#jdzxnayued thead, #jdzxnayued tbody, #jdzxnayued tfoot, #jdzxnayued tr, #jdzxnayued td, #jdzxnayued th {
  border-style: none;
}

#jdzxnayued p {
  margin: 0;
  padding: 0;
}

#jdzxnayued .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jdzxnayued .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#jdzxnayued .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jdzxnayued .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jdzxnayued .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jdzxnayued .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jdzxnayued .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jdzxnayued .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jdzxnayued .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jdzxnayued .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jdzxnayued .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jdzxnayued .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jdzxnayued .gt_spanner_row {
  border-bottom-style: hidden;
}

#jdzxnayued .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#jdzxnayued .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jdzxnayued .gt_from_md > :first-child {
  margin-top: 0;
}

#jdzxnayued .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jdzxnayued .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jdzxnayued .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#jdzxnayued .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jdzxnayued .gt_row_group_first td {
  border-top-width: 2px;
}

#jdzxnayued .gt_row_group_first th {
  border-top-width: 2px;
}

#jdzxnayued .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jdzxnayued .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#jdzxnayued .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jdzxnayued .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jdzxnayued .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jdzxnayued .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jdzxnayued .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#jdzxnayued .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jdzxnayued .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jdzxnayued .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jdzxnayued .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jdzxnayued .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jdzxnayued .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jdzxnayued .gt_left {
  text-align: left;
}

#jdzxnayued .gt_center {
  text-align: center;
}

#jdzxnayued .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jdzxnayued .gt_font_normal {
  font-weight: normal;
}

#jdzxnayued .gt_font_bold {
  font-weight: bold;
}

#jdzxnayued .gt_font_italic {
  font-style: italic;
}

#jdzxnayued .gt_super {
  font-size: 65%;
}

#jdzxnayued .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#jdzxnayued .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jdzxnayued .gt_indent_1 {
  text-indent: 5px;
}

#jdzxnayued .gt_indent_2 {
  text-indent: 10px;
}

#jdzxnayued .gt_indent_3 {
  text-indent: 15px;
}

#jdzxnayued .gt_indent_4 {
  text-indent: 20px;
}

#jdzxnayued .gt_indent_5 {
  text-indent: 25px;
}

#jdzxnayued .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#jdzxnayued div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings header">
<th id="ID" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ID</th>
<th id="Clone" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Clone</th>
<th id="month" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">month</th>
<th id="Al_conc" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Al_conc</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="ID">1</td>
<td class="gt_row gt_left" headers="Clone">Balsam_Spire</td>
<td class="gt_row gt_left" headers="month">August</td>
<td class="gt_row gt_right" headers="Al_conc">8.1</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="ID">1</td>
<td class="gt_row gt_left" headers="Clone">Balsam_Spire</td>
<td class="gt_row gt_left" headers="month">November</td>
<td class="gt_row gt_right" headers="Al_conc">11.2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="ID">2</td>
<td class="gt_row gt_left" headers="Clone">Beaupre</td>
<td class="gt_row gt_left" headers="month">August</td>
<td class="gt_row gt_right" headers="Al_conc">10.0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="ID">2</td>
<td class="gt_row gt_left" headers="Clone">Beaupre</td>
<td class="gt_row gt_left" headers="month">November</td>
<td class="gt_row gt_right" headers="Al_conc">16.3</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="ID">3</td>
<td class="gt_row gt_left" headers="Clone">Hazendans</td>
<td class="gt_row gt_left" headers="month">August</td>
<td class="gt_row gt_right" headers="Al_conc">16.5</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="ID">3</td>
<td class="gt_row gt_left" headers="Clone">Hazendans</td>
<td class="gt_row gt_left" headers="month">November</td>
<td class="gt_row gt_right" headers="Al_conc">15.3</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="ID">4</td>
<td class="gt_row gt_left" headers="Clone">Hoogvorst</td>
<td class="gt_row gt_left" headers="month">August</td>
<td class="gt_row gt_right" headers="Al_conc">13.6</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="ID">4</td>
<td class="gt_row gt_left" headers="Clone">Hoogvorst</td>
<td class="gt_row gt_left" headers="month">November</td>
<td class="gt_row gt_right" headers="Al_conc">15.6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now we can plot the data as a box plot, with one box for August and one for November ie one for each level of the factor <code>month</code>. Had we not first tidied the data, we could not have done this.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poplars_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># group = ID makes the lines join elements of each pair</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">month</span>, y <span class="op">=</span> <span class="va">Al_conc</span>, fill <span class="op">=</span> <span class="va">month</span>, colour <span class="op">=</span> <span class="va">month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># alpa (= opacity) &lt; 1 in case any points are on top of each other</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>outlier.size<span class="op">=</span><span class="fl">0</span>,alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="va">ID</span><span class="op">)</span>,colour <span class="op">=</span> <span class="st">"grey60"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Month"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Al conc.(mu g Al / g wood)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html">theme_cowplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="tests_for_difference_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Does it look as though the difference between the medians could plausibly be zero for the population? Or, put another way, if it was zero, how big a fluke would this sample be? That is what the p value actually tells us.</p>
<section id="two-sample-paired-t-test" class="level3"><h3 class="anchored" data-anchor-id="two-sample-paired-t-test">Two sample paired t-test</h3>
<p><strong>Check for normality of differences</strong></p>
<p>Before we use the t-test, we need to check that it is OK to do so. This means checking whether the paired differences are plausibly drawn from a normal distribution centred on zero.</p>
<p>The null hypothesis of the Shapiro-Wilk test is that the data set given to it <em>is</em> drawn from a normally distributed population. So let us give our sample of paired differences:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/shapiro.test.html">shapiro.test</a></span><span class="op">(</span><span class="va">poplars</span><span class="op">$</span><span class="va">August</span><span class="op">-</span><span class="va">poplars</span><span class="op">$</span><span class="va">November</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  poplars$August - poplars$November
W = 0.92667, p-value = 0.3081</code></pre>
</div>
</div>
<p>The p value is very high. Thus we do not reject the null hypothesis and we can reasonably assume that the differences between the August and November aluminium concentrations in the sample could plausibly have been drawn from a normally distributed population, despite the outlier value in the November sample. Thus we can reasonably test for difference using a paired t-test.</p>
<p><strong>The actual t-test</strong></p>
<p>We can do this in R using the function <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code>, where we give to the function both the August and the November data, knowing that each August value has a counterpart November value, and we set the argument <code>paired</code> to <code>TRUE</code>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">poplars</span><span class="op">$</span><span class="va">August</span>, <span class="va">poplars</span><span class="op">$</span><span class="va">November</span>, paired <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
    Paired t-test

data:  poplars$August and poplars$November
t = -2.3089, df = 12, p-value = 0.03956
alternative hypothesis: true mean difference is not equal to 0
95 percent confidence interval:
 -9.5239348 -0.2760652
sample estimates:
mean difference 
           -4.9 </code></pre>
</div>
</div>
<p>All parts of the output have meaning and are useful, but here we will focus on just two:</p>
<ul>
<li>the p value is equal to 0.040. Hence, if we have chosen the usual significance value of 0.05, we can take this to mean that there is evidence of a significant difference between the August and November values.</li>
<li>the lower and upper bounds of the 95% confidence interval are (-9.52, -0.28). This tells us that if samples such as we have were collected again and again, then the mean difference between the August and the November paired values would be in this range 95% of the time. The key thing is that this range does not encompass zero. This means that we can be confident at the 95% level that there is a non-zero change on going from August to November, and, in particular, that the August value is lower than the November value.</li>
</ul></section></section><section id="the-non-parametric-alternative-the-wilcoxon-signed-rank-test" class="level2"><h2 class="anchored" data-anchor-id="the-non-parametric-alternative-the-wilcoxon-signed-rank-test">The non-parametric alternative: The Wilcoxon signed rank test</h2>
<p>To be safe, because of that outlier, let us test for difference using the Wilcoxon signed rank test. In R this is done using the function <code><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test()</a></code>, with the argument <code>paired</code> set to <code>TRUE</code>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test</a></span><span class="op">(</span><span class="va">poplars</span><span class="op">$</span><span class="va">August</span>, <span class="va">poplars</span><span class="op">$</span><span class="va">November</span>, paired <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon signed rank exact test

data:  poplars$August and poplars$November
V = 16, p-value = 0.03979
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<p>We see that the conclusion (in this case) is the same.</p>
</section><section id="relation-to-one-sample-paired-test" class="level2"><h2 class="anchored" data-anchor-id="relation-to-one-sample-paired-test">Relation to one-sample paired test</h2>
<p>The two-sample paired tests as we have done above are the same as doing a one-sample test to see if the differences between the August and November paired values is different from zero. This is true whether we do a t-test or a Wilcoxon signed rank test.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">poplars</span><span class="op">$</span><span class="va">August</span> <span class="op">-</span> <span class="va">poplars</span><span class="op">$</span><span class="va">November</span>, mu <span class="op">=</span> <span class="fl">0</span>, data <span class="op">=</span> <span class="va">poplars</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  poplars$August - poplars$November
t = -2.3089, df = 12, p-value = 0.03956
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 -9.5239348 -0.2760652
sample estimates:
mean of x 
     -4.9 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test</a></span><span class="op">(</span><span class="va">poplars</span><span class="op">$</span><span class="va">August</span> <span class="op">-</span> <span class="va">poplars</span><span class="op">$</span><span class="va">November</span>, mu <span class="op">=</span> <span class="fl">0</span>, data <span class="op">=</span> <span class="va">poplars</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon signed rank exact test

data:  poplars$August - poplars$November
V = 16, p-value = 0.03979
alternative hypothesis: true location is not equal to 0</code></pre>
</div>
</div>
<!-- -->

</section></section></main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb42" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Tests for difference: two sample *t*-test"</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Michael Hunt"</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> ""</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">  revealjs:</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co">    transition: slide</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co">    transition-speed: fast</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co">    slide-number: c/t</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co">    width: 1600</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="co">    height: 900</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> source</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include = FALSE}</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="in">library(here)</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="in">library(rstatix)</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggthemes)</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a><span class="in">library(gt)</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>In this document we consider tests for difference where there are two levels being compared.</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a><span class="fu"># Test finder flow chart</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>First, use this flowchart to see if a two-sample t-test or its non-parametric counterpart the Mann-Whitney-U test is appropriate for your question, your study design and your data:</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid, include = TRUE, echo = FALSE}</span></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart TD</span></span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a><span class="in">  A{Difference or Trend \nQuestion?} --&gt; B[Trend]</span></span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a><span class="in">  B --&gt; B2{Are you testing for \ndegree of association\nor are you trying \nto make predictions?}</span></span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a><span class="in">  B2 --&gt; B33[Association:\n\nTest for\n correlation coefficient\nPearson or \n Spearman's Rank]</span></span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a><span class="in">  B2 --&gt; B44[Predictions:\n\nSimple linear regression]</span></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a><span class="in">  A --&gt; C[Difference]</span></span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a><span class="in">  C --&gt; C22{Do you have replicates?}</span></span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a><span class="in">  C22 --&gt; C22Y[Yes]</span></span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a><span class="in">  C22 --&gt; C22N[No]</span></span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a><span class="in">  C22N --&gt; C23{Do you have count data?}</span></span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a><span class="in">  C23 --&gt; C23Y[Yes]</span></span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a><span class="in">  C23 --&gt; C23N[N0]</span></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a><span class="in">  C23Y --&gt; C24(Chi square test:\nGoodness of fit\nor\nTest of independence)</span></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a><span class="in">  C23N --&gt; C25[These data cannot be analysed]</span></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a><span class="in">  C22Y --&gt; D{How many factors?}</span></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a><span class="in">  D --&gt; F[Two or more]</span></span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a><span class="in">  F --&gt; F2{Independent\nsamples?}</span></span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a><span class="in">  F2 --&gt; F2Y[Yes]</span></span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a><span class="in">  F2 --&gt; F2N[No]</span></span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a><span class="in">  F2Y --&gt; F22Y(n-way ANOVA)</span></span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a><span class="in">  F2N --&gt; F22N(n-way\nrepeated measures\nANOVA)</span></span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a><span class="in">  D --&gt; E[One]</span></span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a><span class="in">  E --&gt; G{How many levels?}</span></span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a><span class="in">  G --&gt; H[Two]</span></span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a><span class="in">  G --&gt; I[More than two]</span></span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a><span class="in">  I --&gt; J{Independent\n samples?}</span></span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a><span class="in">  J --&gt; K[No]</span></span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a><span class="in">  J --&gt; L[Yes]</span></span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a><span class="in">  K --&gt; S(Repeated measures one-way ANOVA\nor\nFriedman Test)</span></span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a><span class="in">  L --&gt; T(One way ANOVA\nor\nKruskal Wallis one-way test)</span></span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a><span class="in">  H --&gt; M{Independent\n samples?}</span></span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a><span class="in">  M --&gt; N[No]</span></span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a><span class="in">  M --&gt; O[Yes]</span></span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a><span class="in">  N --&gt; P(paired t-test\nor\nSigned rank test)</span></span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a><span class="in">  O --&gt; Q(two sample t-test\nor\nMatt Whitney U test)</span></span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a>If this chart suggests you need something other than the two sample t-test or Mann-Whitney test, you need to go to the descriptions of that test.</span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a><span class="fu"># Two sample t-test: the parametric case</span></span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a>In this exercise we find out how to run a two-sample *t*-test, to determine whether there is evidence to reject the hypothesis that two samples are drawn from the same population.</span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a><span class="fu">## When to use the two-sample *t*-test</span></span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It can be used when we have two independent samples of **numerical** (not ordinal) response data, and our question is whether the data provide evidence that the samples are drawn from different populations. Even when this criterion is met and the data are numerical and independent, the normality criterion described below still needs to be met. That apart, two common examples where we have two sets of data but we should not use the two sample *t*-test are:</span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-88"><a href="#cb42-88" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If the data in your two samples are not independent because you have measured the same individual replicate before and after some event or treatment, then you should probably be using a **paired *t*-test** instead. In this you don't have two samples, each comprising a separate and independent set of replicates. Instead, you have multiple pairs of values, one pair per replicate. The replicates are still assumed to be independent of each other</span>
<span id="cb42-89"><a href="#cb42-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-90"><a href="#cb42-90" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If your response data are the answers to a Likert scale such as might be used in a survey then they are *ordinal* in nature and not numerical, and you should probably be using the non-parametric equivalent of the two sample *t*-test, which is variously known as the **Wilcoxon Rank Sum test** or as the **Mann Whitney U test**, or its paired sample version, if appropriate.</span>
<span id="cb42-91"><a href="#cb42-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It can be used when the data set is small. But not so small that there are no replicates. You **do** need replicates.</span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It can still be used when the data set is large.</span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-96"><a href="#cb42-96" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It assumes that the data are drawn from a normally distributed population. There are various ways to test if this is plausibly the case, and you should try at least one of them, but with small samples, just where the *t*-test is most useful, it can be difficult to tell. In the end we can also appeal to reason: is there good reason to suppose that the data would or would not be normally distributed?</span>
<span id="cb42-97"><a href="#cb42-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When comparing the means of two samples, both samples should in principle have the same variance, which is a measure of the spread of the data, so in principle you need to check that this is at least *approximately* the case, or have reason to suppose that it should be. *However*, in an actual *t*-test done using R, the Welch variant of the *t*-test is carried out by default. This works even when the variances of the two sets are different, so in practice it is possible to ignore this equal variance requirement.</span>
<span id="cb42-99"><a href="#cb42-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-100"><a href="#cb42-100" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We only use it when we are comparing two samples, one for each of the two levels of a single factor. When we have samples for more than two levels and we use the *t*-test to look for a difference between any two of them, it becomes increasingly likely, the more pairs of samples we compare, that we will decide that we have found a difference because we got a *p*-value that was less than some pre-determined threshold (which could be anything, but is most often chosen to be 0.05) even if in reality there is none. This is the problem of high false positive rates arising from multiple pairwise testing and is where ANOVA comes in. *t*-tests are only used to detect evidence for a difference between two groups, not more. ANOVAs (or their non-parametric equivalent) are used when we are looking for differences between more than two groups.</span>
<span id="cb42-101"><a href="#cb42-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-102"><a href="#cb42-102" aria-hidden="true" tabindex="-1"></a><span class="fu">## Motivation and example</span></span>
<span id="cb42-103"><a href="#cb42-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-104"><a href="#cb42-104" aria-hidden="true" tabindex="-1"></a>In our example we will consider the impact of pesticide use on the masses of shells of garden snails (*Cornu aspersum*), as measured in gardens around a city, ten from randomly selected gardens that have used a range of pesticides for at least two years and ten that are from randomly selected gardens that have not ever used pesticides. We leave aside here the issue of how those gardens were identified and how randomisation was ensured.</span>
<span id="cb42-105"><a href="#cb42-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-106"><a href="#cb42-106" aria-hidden="true" tabindex="-1"></a><span class="fu">### Questions and hypotheses</span></span>
<span id="cb42-107"><a href="#cb42-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-108"><a href="#cb42-108" aria-hidden="true" tabindex="-1"></a>Our **question** is:</span>
<span id="cb42-109"><a href="#cb42-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-110"><a href="#cb42-110" aria-hidden="true" tabindex="-1"></a>*Is there evidence for a difference between snail shell masses in the gardens where pesticides were used compared to those where they were not used?*</span>
<span id="cb42-111"><a href="#cb42-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-112"><a href="#cb42-112" aria-hidden="true" tabindex="-1"></a>From which a suitable **null hypothesis** is:</span>
<span id="cb42-113"><a href="#cb42-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-114"><a href="#cb42-114" aria-hidden="true" tabindex="-1"></a>*There is no difference between shell masses in the gardens, whether or not pesticides were used.*</span>
<span id="cb42-115"><a href="#cb42-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-116"><a href="#cb42-116" aria-hidden="true" tabindex="-1"></a>and a suitable **alternate, two-sided hypothesis** is:</span>
<span id="cb42-117"><a href="#cb42-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-118"><a href="#cb42-118" aria-hidden="true" tabindex="-1"></a>*There is a difference between shell masses.*</span>
<span id="cb42-119"><a href="#cb42-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-120"><a href="#cb42-120" aria-hidden="true" tabindex="-1"></a><span class="fu">## The data</span></span>
<span id="cb42-121"><a href="#cb42-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-122"><a href="#cb42-122" aria-hidden="true" tabindex="-1"></a>Suppose we had our data arranged in a spreadsheet in three columns, one giving the garden ID, G1 to G20, one telling us whether pesticides were used in the garden, yes or no, and one telling us the masses in grams of the snail shells from each garden. Afficioados of R will see that this is 'tidy' data. Each variable (ID, pesticide use, shell mass) occurs in only one column, rather than being spread across several. It turns out that this way of storing your data makes it much easier to analyse.</span>
<span id="cb42-123"><a href="#cb42-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-126"><a href="#cb42-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-127"><a href="#cb42-127" aria-hidden="true" tabindex="-1"></a><span class="co"># there should be a 'garden_snails.csv' file in your data folder</span></span>
<span id="cb42-128"><a href="#cb42-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-129"><a href="#cb42-129" aria-hidden="true" tabindex="-1"></a>filepath<span class="ot">&lt;-</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"garden_snails.csv"</span>)</span>
<span id="cb42-130"><a href="#cb42-130" aria-hidden="true" tabindex="-1"></a>snails<span class="ot">&lt;-</span><span class="fu">read_csv</span>(filepath)</span>
<span id="cb42-131"><a href="#cb42-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-132"><a href="#cb42-132" aria-hidden="true" tabindex="-1"></a><span class="co"># if not, you should be able to get it from Mike's github repo</span></span>
<span id="cb42-133"><a href="#cb42-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-134"><a href="#cb42-134" aria-hidden="true" tabindex="-1"></a><span class="co"># file_url &lt;- "https://raw.githubusercontent.com/mbh038/r-workshop/refs/heads/gh-pages/data/garden_snails.csv"</span></span>
<span id="cb42-135"><a href="#cb42-135" aria-hidden="true" tabindex="-1"></a><span class="co"># snails&lt;-read_csv(file_url)</span></span>
<span id="cb42-136"><a href="#cb42-136" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(snails,<span class="dv">20</span>)</span>
<span id="cb42-137"><a href="#cb42-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-138"><a href="#cb42-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-139"><a href="#cb42-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-140"><a href="#cb42-140" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Is this a tidy data set?</span>
<span id="cb42-141"><a href="#cb42-141" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Is the data in the <span class="in">`pesticide`</span> column categorical?</span>
<span id="cb42-142"><a href="#cb42-142" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>If so, how many levels does it have and what are they?</span>
<span id="cb42-143"><a href="#cb42-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-144"><a href="#cb42-144" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Process</span></span>
<span id="cb42-145"><a href="#cb42-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-146"><a href="#cb42-146" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step One: Summarise the data</span></span>
<span id="cb42-147"><a href="#cb42-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-148"><a href="#cb42-148" aria-hidden="true" tabindex="-1"></a>With numerical data spread across more than one level of a categorical variable, we often want summary information such as mean values and standard errors of the mean for each level.</span>
<span id="cb42-149"><a href="#cb42-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-150"><a href="#cb42-150" aria-hidden="true" tabindex="-1"></a>Here we will calculate the number of replicates, the mean and the standard error of the mean for both levels of <span class="in">`pesticide`</span> ie Yes and No:</span>
<span id="cb42-151"><a href="#cb42-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-154"><a href="#cb42-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-155"><a href="#cb42-155" aria-hidden="true" tabindex="-1"></a>snail.summary<span class="ot">&lt;-</span> snails <span class="sc">|&gt;</span></span>
<span id="cb42-156"><a href="#cb42-156" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(pesticide) <span class="sc">|&gt;</span></span>
<span id="cb42-157"><a href="#cb42-157" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb42-158"><a href="#cb42-158" aria-hidden="true" tabindex="-1"></a>          <span class="at">mean.mass =</span> <span class="fu">mean</span>(shell_mass_g),</span>
<span id="cb42-159"><a href="#cb42-159" aria-hidden="true" tabindex="-1"></a>          <span class="at">se.mass =</span> <span class="fu">sd</span>(shell_mass_g)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">n</span>()))</span>
<span id="cb42-160"><a href="#cb42-160" aria-hidden="true" tabindex="-1"></a>snail.summary</span>
<span id="cb42-161"><a href="#cb42-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-162"><a href="#cb42-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-163"><a href="#cb42-163" aria-hidden="true" tabindex="-1"></a>From these data, does it look as though there is evidence for a difference between shell masses in the two types of garden? Clearly, the snails in the ten gardens that did not use pesticide had a higher mean shell mass than the ten from gardens that did use pesticide. But is this a fluke? How precisely do we think these sample means reflect the truth about the impact of the use of pesticides? That is what the standard error column tells us. You can think of the standard error as being an estimate of how far our sample means, drawn from just ten gardens of each type are likely to differ from the true shell masses for all gardens that did use pesticides and all gardens that did not.</span>
<span id="cb42-164"><a href="#cb42-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-165"><a href="#cb42-165" aria-hidden="true" tabindex="-1"></a>Bottom line: the difference between the sample means is about ten times the size of the standard errors of each. It really does look as though snails shells in gardens where pesticides are not used are indeed heavier than in gardens where pesticides are used.</span>
<span id="cb42-166"><a href="#cb42-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-167"><a href="#cb42-167" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step Two: Plot the data</span></span>
<span id="cb42-168"><a href="#cb42-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-169"><a href="#cb42-169" aria-hidden="true" tabindex="-1"></a>Remember, before we do any statistical analysis, it is almost always a good idea to plot the data in some way. We can often get a very good idea as to the answer to our research question just from the plots we do.</span>
<span id="cb42-170"><a href="#cb42-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-171"><a href="#cb42-171" aria-hidden="true" tabindex="-1"></a>In @fig-histograms, we will use <span class="in">`ggplot()`</span> in R to plot a histogram of ozone levels, one for each side of the city. We will stack the histograms one above the other, all the better to help us spot any differences between east and west.</span>
<span id="cb42-172"><a href="#cb42-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-175"><a href="#cb42-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-176"><a href="#cb42-176" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-histograms</span></span>
<span id="cb42-177"><a href="#cb42-177" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Stacked histograms"</span></span>
<span id="cb42-178"><a href="#cb42-178" aria-hidden="true" tabindex="-1"></a>snails <span class="sc">|&gt;</span></span>
<span id="cb42-179"><a href="#cb42-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>shell_mass_g)) <span class="sc">+</span></span>
<span id="cb42-180"><a href="#cb42-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="fl">0.2</span>,<span class="at">fill=</span><span class="st">"darkred"</span>)<span class="sc">+</span></span>
<span id="cb42-181"><a href="#cb42-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>pesticide,<span class="at">ncol=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb42-182"><a href="#cb42-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb42-183"><a href="#cb42-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-184"><a href="#cb42-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-185"><a href="#cb42-185" aria-hidden="true" tabindex="-1"></a>Instead of histograms, we could have drawn box plots, as in:</span>
<span id="cb42-186"><a href="#cb42-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-189"><a href="#cb42-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-190"><a href="#cb42-190" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-boxplot</span></span>
<span id="cb42-191"><a href="#cb42-191" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Side-byside box and whisker plots of the distribution of values in each snail sample. The lower and upper edges of each box show the 25th and 75th percentiles of each sample, and the thick black line between them shows the median value ie the 50th percentile"</span></span>
<span id="cb42-192"><a href="#cb42-192" aria-hidden="true" tabindex="-1"></a>snails <span class="sc">|&gt;</span></span>
<span id="cb42-193"><a href="#cb42-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>pesticide,<span class="at">y=</span>shell_mass_g))<span class="sc">+</span></span>
<span id="cb42-194"><a href="#cb42-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb42-195"><a href="#cb42-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Pestice use?"</span>,</span>
<span id="cb42-196"><a href="#cb42-196" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Shell mass (g)"</span>) <span class="sc">+</span></span>
<span id="cb42-197"><a href="#cb42-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb42-198"><a href="#cb42-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-199"><a href="#cb42-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-200"><a href="#cb42-200" aria-hidden="true" tabindex="-1"></a>or as a dot plot of the means with standard errors of the mean included as error bars, as in @fig-means-se</span>
<span id="cb42-201"><a href="#cb42-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-204"><a href="#cb42-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-205"><a href="#cb42-205" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-means-se</span></span>
<span id="cb42-206"><a href="#cb42-206" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The data points show mean values, the error bars show plus or minus one standard error of the mean"</span></span>
<span id="cb42-207"><a href="#cb42-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-208"><a href="#cb42-208" aria-hidden="true" tabindex="-1"></a><span class="co"># for this chart we will use the summary table that we created above.</span></span>
<span id="cb42-209"><a href="#cb42-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-210"><a href="#cb42-210" aria-hidden="true" tabindex="-1"></a>snail.summary <span class="sc">|&gt;</span> </span>
<span id="cb42-211"><a href="#cb42-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>pesticide,<span class="at">y=</span>mean.mass))<span class="sc">+</span></span>
<span id="cb42-212"><a href="#cb42-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb42-213"><a href="#cb42-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>mean.mass<span class="sc">-</span>se.mass,<span class="at">ymax=</span>mean.mass<span class="sc">+</span>se.mass),<span class="at">width=</span><span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb42-214"><a href="#cb42-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">4</span>) <span class="sc">+</span> <span class="co"># try leaving this line out. What happens? Which is better?</span></span>
<span id="cb42-215"><a href="#cb42-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Pesticide use?"</span>,</span>
<span id="cb42-216"><a href="#cb42-216" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Shell mass (g)"</span>) <span class="sc">+</span></span>
<span id="cb42-217"><a href="#cb42-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb42-218"><a href="#cb42-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-219"><a href="#cb42-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-220"><a href="#cb42-220" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Do the data look as though they are inconsistent with the null hypothesis ?</span>
<span id="cb42-221"><a href="#cb42-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-222"><a href="#cb42-222" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In addition, do the data look as though each group is drawn from a normally distributed population? One of the types of graphs gives you no indication of that while the other two do. Which is the odd one out? Even when looking at the other two figures, when there are so few data it's kind of hard to tell, no?</span>
<span id="cb42-223"><a href="#cb42-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-224"><a href="#cb42-224" aria-hidden="true" tabindex="-1"></a>Let's now do some stats.</span>
<span id="cb42-225"><a href="#cb42-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-226"><a href="#cb42-226" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step Three: Check the validity of the data - are the data normally distributed?</span></span>
<span id="cb42-227"><a href="#cb42-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-228"><a href="#cb42-228" aria-hidden="true" tabindex="-1"></a>We can go about establishing this in three ways: using an analytical test of normality, using a graphical method and by thinking about what kind of data we have. Let's consider these in turn.</span>
<span id="cb42-229"><a href="#cb42-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-230"><a href="#cb42-230" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Normality test - analytical method</span></span>
<span id="cb42-231"><a href="#cb42-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-232"><a href="#cb42-232" aria-hidden="true" tabindex="-1"></a>There are several analytical tests one can run on a set of data to determine if it is plausible that it has been drawn from a normally distributed population. One is the Shapiro-Wilk test.</span>
<span id="cb42-233"><a href="#cb42-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-234"><a href="#cb42-234" aria-hidden="true" tabindex="-1"></a>For more information on the Shapiro-Wilk test in R, type <span class="in">`?shapiro.test`</span> into the console window. For kicks, try it out on the examples that appear in the help window (which is the bottom right pane, Help tab). One example is testing a sample of data that explicitly *is* drawn from a normal distribution, the other tests a sample of data that definitely *is not*. What *p*-value do you get in each case? How closely do the histograms of each sample resemble a normal distribution?</span>
<span id="cb42-235"><a href="#cb42-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-238"><a href="#cb42-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-239"><a href="#cb42-239" aria-hidden="true" tabindex="-1"></a><span class="co">#first we create a data frame containing the two example data sets</span></span>
<span id="cb42-240"><a href="#cb42-240" aria-hidden="true" tabindex="-1"></a>example1<span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">3</span>) <span class="co"># first example from the help pane</span></span>
<span id="cb42-241"><a href="#cb42-241" aria-hidden="true" tabindex="-1"></a>example2<span class="ot">&lt;-</span><span class="fu">runif</span>(<span class="dv">500</span>, <span class="at">min =</span> <span class="dv">2</span>, <span class="at">max =</span> <span class="dv">4</span>) <span class="co"># second example from the help pane</span></span>
<span id="cb42-242"><a href="#cb42-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-243"><a href="#cb42-243" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">tibble</span>(<span class="at">data=</span><span class="fu">c</span>(example1,example2), <span class="at">distribution=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"example 1: normal"</span>,<span class="dv">500</span>),<span class="fu">rep</span>(<span class="st">"example 2: not at all normal"</span>,<span class="dv">500</span>)))</span>
<span id="cb42-244"><a href="#cb42-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-245"><a href="#cb42-245" aria-hidden="true" tabindex="-1"></a><span class="co"># then we plot a histogram of each data set</span></span>
<span id="cb42-246"><a href="#cb42-246" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df,<span class="fu">aes</span>(<span class="at">x=</span>data)) <span class="sc">+</span></span>
<span id="cb42-247"><a href="#cb42-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>,<span class="at">fill=</span><span class="st">"cornflowerblue"</span>) <span class="sc">+</span></span>
<span id="cb42-248"><a href="#cb42-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>distribution) <span class="sc">+</span></span>
<span id="cb42-249"><a href="#cb42-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb42-250"><a href="#cb42-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-251"><a href="#cb42-251" aria-hidden="true" tabindex="-1"></a><span class="co"># and finally we run a Shapiro-Wilk normality test on each data set</span></span>
<span id="cb42-252"><a href="#cb42-252" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(example1) <span class="co"># 100 samples drawn from a normally distributed population</span></span>
<span id="cb42-253"><a href="#cb42-253" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(example2) <span class="co"># 100 samples drawn from a uniformly (ie NOT normally) distributed population</span></span>
<span id="cb42-254"><a href="#cb42-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-255"><a href="#cb42-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-256"><a href="#cb42-256" aria-hidden="true" tabindex="-1"></a>For the examples above, we see that Shapiro-Wilk test gave a high *p*-value for the data that we knew *were* drawn from a normal distribution, and a very low *p*-value for the data that we knew were not.</span>
<span id="cb42-257"><a href="#cb42-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-258"><a href="#cb42-258" aria-hidden="true" tabindex="-1"></a>The Shapiro-Wilk test tests your data against the null hypothesis that it is drawn from a normally distributed population. It gives a *p*-value which, as always, is the probably of you having data as far from normality, or further, as yours are if the null hypothesis were true. If the *p*-value is less than 0.05 then we reject the null hypothesis and cannot suppose our data is drawn froma normally distributed population. In that case we would have to ditch the *t*-test for a difference, and choose another difference test in its place that could cope with data that was not normally distributed. For a two-sample *t*-test such as we are hoping to use here, the so-called non-parametric alternative that we could use instead is the Wilcoxon Rank Sum test, often called the Mann-Whitney U test.</span>
<span id="cb42-259"><a href="#cb42-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-260"><a href="#cb42-260" aria-hidden="true" tabindex="-1"></a>Why don't we do that in the first place, I hear you ask? Why bother with this finicky *t*-test that requires that we go through the faff of testing the data for normality before we can use it? The answer is that it is more powerful than other, so-called non-parametric tests that *can* cope with non-normal data. It is more likely than they are to spot a difference if there really is a difference. So if we can use it, that is what we would rather do.</span>
<span id="cb42-261"><a href="#cb42-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-262"><a href="#cb42-262" aria-hidden="true" tabindex="-1"></a>So, onwards, let's do the Shapiro-Wilk test on our data</span>
<span id="cb42-263"><a href="#cb42-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-264"><a href="#cb42-264" aria-hidden="true" tabindex="-1"></a>We want to test each garden group for normality, so we group the data by location as before and and then summarise, this time asking for the *p*-value returned by the Shapiro-Wilk test of normality.</span>
<span id="cb42-265"><a href="#cb42-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-268"><a href="#cb42-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-269"><a href="#cb42-269" aria-hidden="true" tabindex="-1"></a>snails <span class="sc">|&gt;</span></span>
<span id="cb42-270"><a href="#cb42-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pesticide) <span class="sc">|&gt;</span></span>
<span id="cb42-271"><a href="#cb42-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">'Shapiro-Wilk p-value'</span><span class="ot">=</span><span class="fu">shapiro.test</span>(shell_mass_g)<span class="sc">$</span>p.value)</span>
<span id="cb42-272"><a href="#cb42-272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-273"><a href="#cb42-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-274"><a href="#cb42-274" aria-hidden="true" tabindex="-1"></a>For both groups the *p*-value is more than 0.05, so at the 5% significance level we cannot reject the null hypothesis that the data are normally distributed, so we can go on and use the *t*-test. Yay!</span>
<span id="cb42-275"><a href="#cb42-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-276"><a href="#cb42-276" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Graphical methods - the quantile-quantile or QQ plot.</span></span>
<span id="cb42-277"><a href="#cb42-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-278"><a href="#cb42-278" aria-hidden="true" tabindex="-1"></a>Confession: I don't normally bother with numerical tests for normality such as Shapiro-Wilk. I usually use a graphical method instead.</span>
<span id="cb42-279"><a href="#cb42-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-280"><a href="#cb42-280" aria-hidden="true" tabindex="-1"></a>We have already seen two ways of plotting the data that might help suggest whether it is plausible that the data are drawn from normally distributed populations. Histograms and box plots both indicate how data is distributed, and for normally distributed data both would be symmetrical. Well, they would be, more or less, if the data set was large enough but for small data sets it can be quite hard to tell from either type of plot whether the data are drawn from a normally distributed population.</span>
<span id="cb42-281"><a href="#cb42-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-282"><a href="#cb42-282" aria-hidden="true" tabindex="-1"></a>A better type of plot for making this judgement call is the quantile-quantile or 'qq' plot which basically compares the distribution of your data to that of a normal distribution. If your data are approximately normally distributed then a qq plot will give a straight(-ish) line. Even with small data sets, this is usually easy to spot.</span>
<span id="cb42-283"><a href="#cb42-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-286"><a href="#cb42-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-287"><a href="#cb42-287" aria-hidden="true" tabindex="-1"></a>snails <span class="sc">|&gt;</span></span>
<span id="cb42-288"><a href="#cb42-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample=</span>shell_mass_g)) <span class="sc">+</span></span>
<span id="cb42-289"><a href="#cb42-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>(<span class="at">colour=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb42-290"><a href="#cb42-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>() <span class="sc">+</span></span>
<span id="cb42-291"><a href="#cb42-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>pesticide) <span class="sc">+</span></span>
<span id="cb42-292"><a href="#cb42-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb42-293"><a href="#cb42-293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-294"><a href="#cb42-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-295"><a href="#cb42-295" aria-hidden="true" tabindex="-1"></a>Nothing outrageously non-linear there, so that also suggests we can safely use the *t*-test.</span>
<span id="cb42-296"><a href="#cb42-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-297"><a href="#cb42-297" aria-hidden="true" tabindex="-1"></a>For an overview of how normally distributed and non-normally distributed data looks when plotted in histograms, box plots and quantile-quantile plots, see <span class="co">[</span><span class="ot">this review</span><span class="co">](https://rpubs.com/mbh038/725314)</span></span>
<span id="cb42-298"><a href="#cb42-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-299"><a href="#cb42-299" aria-hidden="true" tabindex="-1"></a><span class="fu">#### The 'thinking about the data' normality test</span></span>
<span id="cb42-300"><a href="#cb42-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-301"><a href="#cb42-301" aria-hidden="true" tabindex="-1"></a>As you might have guessed, this isn't a test as such, but a suggestion that you think about what kind of data you have: is it likely to be normally distributed within its subgroups or not? If the data are numerical values of some physical quantity that is the result of many independent processes, and if the data are not bounded on either side (say by 0 and 100 as for exam scores) then it is quite likely that that they are. If they are count data, or ordinal data, then it is quite likely that they are not.</span>
<span id="cb42-302"><a href="#cb42-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-303"><a href="#cb42-303" aria-hidden="true" tabindex="-1"></a>This way of thinking may be all you can do when data sets are very small and any of the more robus*t* tests for normality presented here leave you not much the wiser.</span>
<span id="cb42-304"><a href="#cb42-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-305"><a href="#cb42-305" aria-hidden="true" tabindex="-1"></a><span class="fu">### Do the actual two-sample *t*-test</span></span>
<span id="cb42-306"><a href="#cb42-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-307"><a href="#cb42-307" aria-hidden="true" tabindex="-1"></a>So, it looks as though it is plausible that the data are drawn from normal distributions. That means we can go on to use a parametric test such as a two sample *t*-test and have confidence in its output.</span>
<span id="cb42-308"><a href="#cb42-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-309"><a href="#cb42-309" aria-hidden="true" tabindex="-1"></a>If we were doing this in R we could use the <span class="in">`t.test()`</span> function for this (other functions are available!). This needs to be given a formula and a data set as arguments. Look up <span class="in">`t.test()`</span> in R's help documentation, and see if you can get the *t*-test to tell you whether there is a significant difference between ozone levels in the east and in the west of the city.</span>
<span id="cb42-310"><a href="#cb42-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-311"><a href="#cb42-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,eval=TRUE}</span></span>
<span id="cb42-312"><a href="#cb42-312" aria-hidden="true" tabindex="-1"></a><span class="in">t.test(shell_mass_g~pesticide,data=snails)</span></span>
<span id="cb42-313"><a href="#cb42-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-314"><a href="#cb42-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-315"><a href="#cb42-315" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpret the output of the *t*-test.</span></span>
<span id="cb42-316"><a href="#cb42-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-317"><a href="#cb42-317" aria-hidden="true" tabindex="-1"></a>Study the output of the *t*-test. Here are some questions to ask yourself.</span>
<span id="cb42-318"><a href="#cb42-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-319"><a href="#cb42-319" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What kind of test was carried out?</span>
<span id="cb42-320"><a href="#cb42-320" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*A Welch two sample t-test*</span>
<span id="cb42-321"><a href="#cb42-321" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What data was used for the test?</span>
<span id="cb42-322"><a href="#cb42-322" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*The snail shell mass in g (the output variable) and pesticide use (the explanatory variable)*</span>
<span id="cb42-323"><a href="#cb42-323" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What is the test statistic of the data?</span>
<span id="cb42-324"><a href="#cb42-324" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*This is t = 5.4172.*</span>
<span id="cb42-325"><a href="#cb42-325" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How many degrees of freedom were there? This number is the number of independent pices of information that were used to calculate the final result. It is usually one, two, or three or so less than the number of data points. Don't overthink it at this stage, especially not the fact that here it is not an integer.</span>
<span id="cb42-326"><a href="#cb42-326" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*df = 12.442*</span>
<span id="cb42-327"><a href="#cb42-327" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What is the p-value?</span>
<span id="cb42-328"><a href="#cb42-328" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*p = 0.0001372. You would most likely report this as p \&lt; 0.001*</span>
<span id="cb42-329"><a href="#cb42-329" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What does the p value mean?</span>
<span id="cb42-330"><a href="#cb42-330" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*It is the likelihood of seeing a difference between sample means as large or larger than the one we found if in fact pesticides made no difference to snail shell mass.*</span>
<span id="cb42-331"><a href="#cb42-331" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What is the confidence interval for the difference between shell masses in gardens that use pesticides and in gardens that do not? Does it encompass zero? Remember that the confidence interval gives the range of values within which the true difference between mean shell masses might reasonably lie, given the data. If that range includes zero then the test is telling is that zero is a plausible value for the difference, and hence that we cannot reject the null hypothesis.</span>
<span id="cb42-332"><a href="#cb42-332" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*The 95% confidence interval has lower bound 0.8397 and upper bound 1.962. This range does not encompass zero.*</span>
<span id="cb42-333"><a href="#cb42-333" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Is there sufficient evidence to reject the null hypothesis?</span>
<span id="cb42-334"><a href="#cb42-334" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*Yes. We see this in two way. First the p value is much less than 0.05 and second, the 95% confidence interval does not encompass zero. In a way, the confidence interval is giving us more information than the p-value, since not only can we deduce whether there is evidence for a significant difference, we can also see how big that difference is and how precisely we know it.*</span>
<span id="cb42-335"><a href="#cb42-335" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What does the word 'Welch' tell you - Google it or look it up in the help for <span class="in">`t.test()`</span>.</span>
<span id="cb42-336"><a href="#cb42-336" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*It tells us that a variant of the t-test is being used in which it does not matter if the two. samples have difference variances (spreads).*</span>
<span id="cb42-337"><a href="#cb42-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-338"><a href="#cb42-338" aria-hidden="true" tabindex="-1"></a><span class="fu">## Other examples where a two sample *t*-test might be used.</span></span>
<span id="cb42-339"><a href="#cb42-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-340"><a href="#cb42-340" aria-hidden="true" tabindex="-1"></a>Remember that *t*-tests in general are used when you have independent samples with multiple replicates drawn from populations corresponding to **two** levels of some factor (eg north coast, south coast; this beach, that beach; polluted place, clean place etc) and you have measured something numerical, like a length or a mass, temperature or concentration. You still have to do the tests for normality described above, but these are the basic criteria.</span>
<span id="cb42-341"><a href="#cb42-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-342"><a href="#cb42-342" aria-hidden="true" tabindex="-1"></a><span class="fu">### Can you think of examples of where you might use a two-sample *t*-test?</span></span>
<span id="cb42-343"><a href="#cb42-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-344"><a href="#cb42-344" aria-hidden="true" tabindex="-1"></a>Here are a few suggestions:</span>
<span id="cb42-345"><a href="#cb42-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-346"><a href="#cb42-346" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Is there a difference between the flight initiation distance of redstarts when confronted by dogs compared to when they are confronted by drones?</span>
<span id="cb42-347"><a href="#cb42-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-348"><a href="#cb42-348" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Is the nitrate concentration of water in a river below a beaver dam different from the nitrate content above that dam?</span>
<span id="cb42-349"><a href="#cb42-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-350"><a href="#cb42-350" aria-hidden="true" tabindex="-1"></a>Can you think of another example?</span>
<span id="cb42-351"><a href="#cb42-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-352"><a href="#cb42-352" aria-hidden="true" tabindex="-1"></a><span class="fu">## What if I can't use a two sample *t*-test?</span></span>
<span id="cb42-353"><a href="#cb42-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-354"><a href="#cb42-354" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Assuming you have two independent samples, this might be because one or both sets failed the normality criterion, or your data are ordinal. In that case the likely alternative is the **non-parametric** equivalent of the *t*-test, variously known as the Wilcoxon Rank Sum test or the Mann Whitney U test.</span>
<span id="cb42-355"><a href="#cb42-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-356"><a href="#cb42-356" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If your data are in fact sets of **paired values**, for example because you measured some attribute of the same individuals before and after some treatment, or at two points in time, then you need to use the paired *t*-test.</span>
<span id="cb42-357"><a href="#cb42-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-358"><a href="#cb42-358" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If you only have **one sample** of replicates and want to compare its mean value to a threshold, then you use a one sample t-test. You might do this, for example, if you had collected sediment samples from an estuary, measured the concentration in those samples of some pollutant such as pathogens from sewage, or phosphates from farm runoff, and then wanted to see if the water was compliant with water quality thresholds as dictated by, say, the Water Framework Directive.</span>
<span id="cb42-359"><a href="#cb42-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-360"><a href="#cb42-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-361"><a href="#cb42-361" aria-hidden="true" tabindex="-1"></a><span class="fu"># The non-parametric case</span></span>
<span id="cb42-362"><a href="#cb42-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-363"><a href="#cb42-363" aria-hidden="true" tabindex="-1"></a>A common scenario is that we have two sets of measurements, and we want to see if there is evidence that they are drawn from different populations. For some data types we can use a *t*-test to do this, but for others we cannot.</span>
<span id="cb42-364"><a href="#cb42-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-365"><a href="#cb42-365" aria-hidden="true" tabindex="-1"></a>A *t*-test requires in particular that the two sets of data are normally distributed around their respective means. With *ordinal* data this makes no sense. The mean is undefined as a concept for such data.</span>
<span id="cb42-366"><a href="#cb42-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-367"><a href="#cb42-367" aria-hidden="true" tabindex="-1"></a>To see this , reflect that for a collection $X$ of numerical data, say, 5, 3, 3, 4, and 5 we would calculate the mean as:</span>
<span id="cb42-368"><a href="#cb42-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-369"><a href="#cb42-369" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-370"><a href="#cb42-370" aria-hidden="true" tabindex="-1"></a>\bar{X} = \frac{5+3+3+4+5}{5} = \frac{20}{5}=4</span>
<span id="cb42-371"><a href="#cb42-371" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-372"><a href="#cb42-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-373"><a href="#cb42-373" aria-hidden="true" tabindex="-1"></a>But trying doing the same to five responses of a Likert scale survey. Say the responses you had to five Likert items (individual questions) were "strongly disagree", "strongly agree", "mildly disagree", "strongly disagree" and "don't care either way".  If you tried to calculate a 'mean' response you would be attempting to add up all these responses and to divide the 'sum' by five, like this:</span>
<span id="cb42-374"><a href="#cb42-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-375"><a href="#cb42-375" aria-hidden="true" tabindex="-1"></a>$$\text{mean response}=\frac{\text{stongly disagree}+\text{strongly agree}+\text{mildly disagree}+\text{stongly disagree}+\text{don't care either way}}{5} = ?</span>
<span id="cb42-376"><a href="#cb42-376" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-377"><a href="#cb42-377" aria-hidden="true" tabindex="-1"></a>This sum makes no sense, I hope you will agree. It makes no sense, not because we are using words to describe our responses, but because, as these are ordinal data, we do not know the size of the gaps between the different points on the scale. Is the difference in agreement between the lowest two, "strongly disagree" and "midly disagree" the same as the gap between the highest two, "mildly agree" and "strongly agree"? We don't know, mainly because 'agreement' is not something that can be measured easily using something like a weighing machine. And if we don't know, then we shouldn't really be adding these responses up or dividing them by anything.</span>
<span id="cb42-378"><a href="#cb42-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-379"><a href="#cb42-379" aria-hidden="true" tabindex="-1"></a>Nevertheless, ordinal data are very common, since they are typically what is generated by survey data, where for example repondents may answer a series of questions ('items'), each with typically five possible responses, but maybe more or fewer, these responses being ordinal in the sense that there is a definite order to them. They might encompass responses like those above, say, or something similar like "very unhappy" to "very happy". They are also common in clinical and veterinary practice where ordinal pain scores are widely used - patients being asked (if they are human) or assessed as to their level of pain on a scale of 1-10, for example. Note that even if the pain value is recorded as a number it is actually a label, that could just as well have been recorded as one of a series of letters, A, B, C etc or emojis, or any symbol you like. You can't take the average of a set of faces!</span>
<span id="cb42-380"><a href="#cb42-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-381"><a href="#cb42-381" aria-hidden="true" tabindex="-1"></a>Thus, formally,  we need another kind of test for a difference. Broadly, we need to use some form of *non-parametric* test where we do not assume that the data has any form of distribution, and where, often, we do not use the actual values of the measurements in our dataset but instead use only their *ranks*. The smallest value would be given rank 1, the next rank 2 and so on. </span>
<span id="cb42-382"><a href="#cb42-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-383"><a href="#cb42-383" aria-hidden="true" tabindex="-1"></a>There are many non-parametric tests out there. Here we will look at only one - the **Wilcoxon Rank Sum Test**, often referred to as a **Mann-Whitney U** test for a difference. We can use this for the scenario we have painted above, where we have two sets of data and we wish to know if these provide evidence that the populations from which the samples have been drawn are in fact different.</span>
<span id="cb42-384"><a href="#cb42-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-385"><a href="#cb42-385" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example</span></span>
<span id="cb42-386"><a href="#cb42-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-387"><a href="#cb42-387" aria-hidden="true" tabindex="-1"></a>This example uses actual data gathered by an Honours Project student.</span>
<span id="cb42-388"><a href="#cb42-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-389"><a href="#cb42-389" aria-hidden="true" tabindex="-1"></a>The student wished to assess peoples' sense of wellbeing using two different sets of questions designed to assess this. The scales chosen were the Warwick–Edinburgh Mental Well-being Scale (WEMWBS) and the New Ecological Paradigm (NEP) Scale. The student wished in particular to determine whether this sense of well-being was affected by whether a person often and actively frequented the coast and made it and the sea a substantive part of their life in one way or another. ie to find out whether there was evidence to support the notion that it could be good for your mental wellbeing to be by the sea and to make it part of your life. </span>
<span id="cb42-390"><a href="#cb42-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-391"><a href="#cb42-391" aria-hidden="true" tabindex="-1"></a>Each scale used consists of 15 questions or 'Likert items', each of which is answered on a 5 point ordinal scale, where a score of 1 indicates lowest wellbeing and a score of 5 indicates highest wellbeing. Thus each respondent could score anything from 15 to 75.</span>
<span id="cb42-392"><a href="#cb42-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-393"><a href="#cb42-393" aria-hidden="true" tabindex="-1"></a>The student got responses from 374 people, 86 of whom were not "marine" users, while the other 288 say that they *were* marine users. The total scores from each respondent were recorded for each type of survey and stored in the file <span class="in">`wellness.csv`</span> which you should find on the module Moodle site / Teams page. Please put this file in the <span class="in">`data`</span> folder of your R project.</span>
<span id="cb42-394"><a href="#cb42-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-395"><a href="#cb42-395" aria-hidden="true" tabindex="-1"></a><span class="fu">## Script</span></span>
<span id="cb42-396"><a href="#cb42-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-397"><a href="#cb42-397" aria-hidden="true" tabindex="-1"></a>The first few chunks of this script carry out the same old-same old that we see in script after script: load packages, load data, summarise data , plot data.</span>
<span id="cb42-398"><a href="#cb42-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-399"><a href="#cb42-399" aria-hidden="true" tabindex="-1"></a>You can run this script by running each chunk in sequence, which you do by clicking the green arrow in the top-right corner of each chunk.</span>
<span id="cb42-400"><a href="#cb42-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-401"><a href="#cb42-401" aria-hidden="true" tabindex="-1"></a>Try also to 'Knit' the script by clicking on the Knit button at the top of the script pane.</span>
<span id="cb42-402"><a href="#cb42-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-403"><a href="#cb42-403" aria-hidden="true" tabindex="-1"></a>If you want to create your own script to use with your own data then you can copy and paste into it any code chunks that would be of use and adapt them as necessary.</span>
<span id="cb42-404"><a href="#cb42-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-405"><a href="#cb42-405" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load packages</span></span>
<span id="cb42-406"><a href="#cb42-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = TRUE}</span></span>
<span id="cb42-407"><a href="#cb42-407" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb42-408"><a href="#cb42-408" aria-hidden="true" tabindex="-1"></a><span class="in">library(here)</span></span>
<span id="cb42-409"><a href="#cb42-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-410"><a href="#cb42-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-411"><a href="#cb42-411" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load data</span></span>
<span id="cb42-412"><a href="#cb42-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-413"><a href="#cb42-413" aria-hidden="true" tabindex="-1"></a>Our data set is in a <span class="in">`.csv`</span> file which we have placed in the data folder within our project folder.</span>
<span id="cb42-414"><a href="#cb42-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-415"><a href="#cb42-415" aria-hidden="true" tabindex="-1"></a>Note that this data set has been stored in 'tidy' form: each variable appears in only column, and each observation appears in only one row.</span>
<span id="cb42-416"><a href="#cb42-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-417"><a href="#cb42-417" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = TRUE}</span></span>
<span id="cb42-418"><a href="#cb42-418" aria-hidden="true" tabindex="-1"></a><span class="in">filepath&lt;-here("data","wellness.csv")</span></span>
<span id="cb42-419"><a href="#cb42-419" aria-hidden="true" tabindex="-1"></a><span class="in">wellness&lt;-read_csv(filepath)</span></span>
<span id="cb42-420"><a href="#cb42-420" aria-hidden="true" tabindex="-1"></a><span class="in">glimpse(wellness)</span></span>
<span id="cb42-421"><a href="#cb42-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-422"><a href="#cb42-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-423"><a href="#cb42-423" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summarise the data</span></span>
<span id="cb42-424"><a href="#cb42-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-425"><a href="#cb42-425" aria-hidden="true" tabindex="-1"></a>We'll calculate the median score (50th percentile) and the 25th and 75th percentile scores. For ordinal data, these summary statistics are well defined, whereas means and standard deviations are not.</span>
<span id="cb42-426"><a href="#cb42-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-427"><a href="#cb42-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = TRUE}</span></span>
<span id="cb42-428"><a href="#cb42-428" aria-hidden="true" tabindex="-1"></a><span class="in">wellness |&gt;</span></span>
<span id="cb42-429"><a href="#cb42-429" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(scale,marine) |&gt;</span></span>
<span id="cb42-430"><a href="#cb42-430" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(median.score=median(total_score),iqr_25=quantile(total_score,0.25),iqr_75=quantile(total_score,0.75))</span></span>
<span id="cb42-431"><a href="#cb42-431" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-432"><a href="#cb42-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-433"><a href="#cb42-433" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot the data</span></span>
<span id="cb42-434"><a href="#cb42-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-435"><a href="#cb42-435" aria-hidden="true" tabindex="-1"></a>Box plots are particularly suitable for ordinal data since they show the 25th and 75th percentiles of the data (the bottom and top of the box) plus the 50th percentile aka the median, which is the thick line across each box. All of these percentiles are well defined quantities for ordinal data.</span>
<span id="cb42-436"><a href="#cb42-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-437"><a href="#cb42-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = TRUE}</span></span>
<span id="cb42-438"><a href="#cb42-438" aria-hidden="true" tabindex="-1"></a><span class="in">wellness |&gt;</span></span>
<span id="cb42-439"><a href="#cb42-439" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = scale,y = total_score,fill = marine)) +</span></span>
<span id="cb42-440"><a href="#cb42-440" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot() +</span></span>
<span id="cb42-441"><a href="#cb42-441" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Likert Scale",</span></span>
<span id="cb42-442"><a href="#cb42-442" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Wellbeing Score") +</span></span>
<span id="cb42-443"><a href="#cb42-443" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic()</span></span>
<span id="cb42-444"><a href="#cb42-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-445"><a href="#cb42-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-446"><a href="#cb42-446" aria-hidden="true" tabindex="-1"></a>Looking at the plot, what do you think each scale suggests about whether proximity to the sea makes a difference to wellbeing?</span>
<span id="cb42-447"><a href="#cb42-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-448"><a href="#cb42-448" aria-hidden="true" tabindex="-1"></a><span class="fu">### Wilcoxon-Mann-Whitney U test</span></span>
<span id="cb42-449"><a href="#cb42-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-450"><a href="#cb42-450" aria-hidden="true" tabindex="-1"></a>First let's pull out the scores as measured by the WEMWBS scale and do a test for a difference between the scores of marine users and those of non-marine users. We can use the <span class="in">`filter()`</span> function to do this.</span>
<span id="cb42-451"><a href="#cb42-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-452"><a href="#cb42-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = TRUE}</span></span>
<span id="cb42-453"><a href="#cb42-453" aria-hidden="true" tabindex="-1"></a><span class="in">WEMWBS&lt;-wellness |&gt; filter(scale=="WEMWBS")</span></span>
<span id="cb42-454"><a href="#cb42-454" aria-hidden="true" tabindex="-1"></a><span class="in">wilcox.test(total_score~marine,data=WEMWBS)</span></span>
<span id="cb42-455"><a href="#cb42-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-456"><a href="#cb42-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-457"><a href="#cb42-457" aria-hidden="true" tabindex="-1"></a>The null hypothesis of this test is that there is no evidence that the data are drawn from different populations. In this case, the *p*-value is very small, so we can confidently reject that null hypothesis and assert that there is evidence, according to the WEMWBS scale that marine use makes a difference to peoples' sense of wellbeing. </span>
<span id="cb42-458"><a href="#cb42-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-459"><a href="#cb42-459" aria-hidden="true" tabindex="-1"></a>Does it make it worse or better? - we can see from the summary table and from the box plot that higher scores are associated with those people who were exposed to a marine environment.</span>
<span id="cb42-460"><a href="#cb42-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-461"><a href="#cb42-461" aria-hidden="true" tabindex="-1"></a>We might report this results as follows, first using a plain English statement of the main finding, and then reporting the type of test use, the value of the test statistci that it calculated and the p value. In this case, because the p value is so small, we would not report its exact value, but simle give an indication of how small it is:</span>
<span id="cb42-462"><a href="#cb42-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-463"><a href="#cb42-463" aria-hidden="true" tabindex="-1"></a>We find evidence, according to the WEMWBS scale, that the wellbeing score is 4.5 or about 10% higher for people exposed to a marine environment (Mann-Whitney U, W = 9077.5, p &lt; 0.001).</span>
<span id="cb42-464"><a href="#cb42-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-465"><a href="#cb42-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-466"><a href="#cb42-466" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb42-467"><a href="#cb42-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-468"><a href="#cb42-468" aria-hidden="true" tabindex="-1"></a>Adapt the code of the last chunk so that you can do the same test but for data as recorded by the nep scale</span>
<span id="cb42-469"><a href="#cb42-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-470"><a href="#cb42-470" aria-hidden="true" tabindex="-1"></a><span class="fu">## When should I use this Wilcoxon-Mann-Whitney U test?</span></span>
<span id="cb42-471"><a href="#cb42-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-472"><a href="#cb42-472" aria-hidden="true" tabindex="-1"></a>The test we have used here is an example of a *non-parametric* test. This means that it does not assume that the data follow a known mathematical distribution and, further, that it can be used with ordinal data.</span>
<span id="cb42-473"><a href="#cb42-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-474"><a href="#cb42-474" aria-hidden="true" tabindex="-1"></a>We used the Mann-Whitney U test in particular because we were testing for a difference, and because the factor of interest - marine exposure - had just two levels - Yes or No. This test is only suitable when there are just two levels, so you can think of it as as a non-parametric alternative to a t-test. </span>
<span id="cb42-475"><a href="#cb42-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-476"><a href="#cb42-476" aria-hidden="true" tabindex="-1"></a>In another setting where we still had just one factor (eg zone of a rocky shore) but there were more than two levels (eg low, mid and high zones of the shore) and we decided that we wanted to do a non-parametric test for a difference, then we would probably use the Kruskal-Wallis test, which you can think of as the non-parametric alternative to a one-way ANOVA.</span>
<span id="cb42-477"><a href="#cb42-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-478"><a href="#cb42-478" aria-hidden="true" tabindex="-1"></a>In this example we used the Mann-Whitney U test because the data were ordinal and thus not suitable to use with a parametric test (but see below!). Where we can, we usually try to use a parametric test as they are more powerful than their non-parametric equivalents, meaning, if there is a trend or a difference in the data, they are better able to detect it.  However those parametric tests (t-test, ANOVA, pearson correlation, PCA, GLM to name but a few) typically require not only that the data are numerical but also a host of other things, including that they follow a particular distribution, usually (but not always) the normal distribution, and this is often not the case with real biological data. Often, especially with count data, there are lots of zeros, or the data distribution is heavily skewed, usually to the right. In these cases, providing the data are independent of each other, we can usually still use a non-parametric test such as we have here. it might not be the most powerful test we can use (GLMs are typically way better if you can use them), but it will work.</span>
<span id="cb42-479"><a href="#cb42-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-480"><a href="#cb42-480" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hang on!</span></span>
<span id="cb42-481"><a href="#cb42-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-482"><a href="#cb42-482" aria-hidden="true" tabindex="-1"></a>The eagle eyed among you may have spotted a massive flaw in the line of argument presented above. We said that ordinal data can't be added up, can't be used to calculate averages and so on. Thus we can't run parametric tests on them and have to look for alternatives, namely, non-parametric tests.</span>
<span id="cb42-483"><a href="#cb42-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-484"><a href="#cb42-484" aria-hidden="true" tabindex="-1"></a>And yet, these non-parametric tests are usually run on the output of Likert *scales* such as we have considered here, where for each person we have a number of Likert *Items* (ie individual questions) that together constitute the *scale*, that each generate a score 1-5, then we *add up the scores* to get a total score. But that means we are adding up ordinal data!!!</span>
<span id="cb42-485"><a href="#cb42-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-486"><a href="#cb42-486" aria-hidden="true" tabindex="-1"></a>It turns out that you actually get much the same results with Likert scale data if you analyse them using supposedly inappropriate parametric tests such as a 2-sample *t*-test as you do if you use a non-parametric test such as the one we considered here, the Mann-Whitney test.</span>
<span id="cb42-487"><a href="#cb42-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-488"><a href="#cb42-488" aria-hidden="true" tabindex="-1"></a>A study by De Winter and Dodou (2010) shows this convincingly.</span>
<span id="cb42-489"><a href="#cb42-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-490"><a href="#cb42-490" aria-hidden="true" tabindex="-1"></a>de Winter, J. F. C., <span class="dv">&amp;#38;</span> Dodou, D. (2010). Five-Point Likert Items: t test versus Mann-Whitney-Wilcoxon (Addendum added October 2012). Practical Assessment, Research, and Evaluation,15, 1–16. https://doi.org/10.7275/bj1p-ts64</span>
<span id="cb42-491"><a href="#cb42-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-492"><a href="#cb42-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-493"><a href="#cb42-493" aria-hidden="true" tabindex="-1"></a>For an enlightening discussion of this paper, see <span class="co">[</span><span class="ot">this blog by Jim Frost</span><span class="co">](https://statisticsbyjim.com/hypothesis-testing/analyze-likert-scale-data/)</span></span>
<span id="cb42-494"><a href="#cb42-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-495"><a href="#cb42-495" aria-hidden="true" tabindex="-1"></a><span class="fu"># Paired data</span></span>
<span id="cb42-496"><a href="#cb42-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-497"><a href="#cb42-497" aria-hidden="true" tabindex="-1"></a>Often one has a sample of replicated data where each element has a counterpart in another matched sample - paired data. A common scenario for this is when there are data for the same individual at two different points in time, for example before and after some event such as the application of a treatment. </span>
<span id="cb42-498"><a href="#cb42-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-499"><a href="#cb42-499" aria-hidden="true" tabindex="-1"></a>In order to determine whether there is a difference between the two sets, one should take the paired aspect into account and not simply match the whole before-set against the whole after-set without doing this. That would be to throw away the information whereby there is likely to be a greater degree of correlation between the responses of an individual before and after the event than there is between any randomly chosen pairs of individuals before and after the event.</span>
<span id="cb42-500"><a href="#cb42-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-501"><a href="#cb42-501" aria-hidden="true" tabindex="-1"></a><span class="fu">## Which test: paired t-test or Wilcoxon signed rank test?</span></span>
<span id="cb42-502"><a href="#cb42-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-503"><a href="#cb42-503" aria-hidden="true" tabindex="-1"></a>There is a choice between at least two tests: the parametric paired t-test and the non-parametric Wilcoxon signed rank test. Ideally one would use the t-test since it is more powerful than the Wilcoxon test. This means several things, but in particular it means that, all else being equal, it can detect a small difference with higher probability than the Wilcoxon test can. </span>
<span id="cb42-504"><a href="#cb42-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-505"><a href="#cb42-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-506"><a href="#cb42-506" aria-hidden="true" tabindex="-1"></a><span class="fu">### The paired t-test</span></span>
<span id="cb42-507"><a href="#cb42-507" aria-hidden="true" tabindex="-1"></a>Where the data are numerical (ie not ordinal) and where the before and after data are both normally distributed around their respective mean values one would use the *paired t-test* in this scenario. One can test for normality using either a test such as the Shapiro-Wilk test, or graphically using either a histogram, a box plot, or (best), a quantile-quantile plot. </span>
<span id="cb42-508"><a href="#cb42-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-509"><a href="#cb42-509" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Wilcoxon Signed Rank test</span></span>
<span id="cb42-510"><a href="#cb42-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-511"><a href="#cb42-511" aria-hidden="true" tabindex="-1"></a>The t-test, an example of a so-called parametric test, is actually pretty robust against departures from normality, but where one doubts its validity due to extreme non-normality or for other reasons such as the ordinal nature of the data, the Wilcoxon signed rank test is a useful non-parametric alternative. It is called non-parametric because it does not make any assumption about the distribution of the data values. It only uses their ranks, where the smallest value gets rank 1, the next smallest gets rank 2, and so on.</span>
<span id="cb42-512"><a href="#cb42-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-513"><a href="#cb42-513" aria-hidden="true" tabindex="-1"></a>So, you typically use this test when you would like to use the paired t-test, but you cannot because one or both of the data sets is way off being normally distributed or is ordinal.</span>
<span id="cb42-514"><a href="#cb42-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-515"><a href="#cb42-515" aria-hidden="true" tabindex="-1"></a><span class="fu">### Null Hypotheses</span></span>
<span id="cb42-516"><a href="#cb42-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-517"><a href="#cb42-517" aria-hidden="true" tabindex="-1"></a>In both the t-test and the Wilcoxon signed rank tests, the null hypothesis is the usual 'nothing going on', 'there is no difference' scenario, but there is a subtle difference between them that reflects the different information that they use. In the Wilcoxon signed rank test the null is that the difference between the *medians* of pairs of observations is zero. This is different from the null hypothesis of the paired t–test, which is that the difference between the *means* of pairs is zero. </span>
<span id="cb42-518"><a href="#cb42-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-519"><a href="#cb42-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-520"><a href="#cb42-520" aria-hidden="true" tabindex="-1"></a><span class="fu">### Test output</span></span>
<span id="cb42-521"><a href="#cb42-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-522"><a href="#cb42-522" aria-hidden="true" tabindex="-1"></a>Both tests will give a p value. This is the probability that the mean (t-test) or median (Wilcoxon signed rank) paired differences between the corresponding before and after sample elements would be equal to or greater than it actually is for the data  if the null hypothesis were true. If the p value is less than some pre-decided 'significance level', usually taken to be 0.05, then we reject the null hypothesis. If it is not, then we fail to reject the null hypothesis.</span>
<span id="cb42-523"><a href="#cb42-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-524"><a href="#cb42-524" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example</span></span>
<span id="cb42-525"><a href="#cb42-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-526"><a href="#cb42-526" aria-hidden="true" tabindex="-1"></a>We will use as an example a data set from Laureysens et al. (2004) that has measurements of metal content in the wood of 13 poplar clones growing in a polluted area, once from each clone in August and once again from each of them in November. The idea was to investigate the extent to which poplars could absorb metals from the soil and thus be useful in cleaning that up. Under a null hypothesis, there would be no change in the metal concentrations in the plant tissue of each clone between August and November. Under an alternate hypothesis, there would be.</span>
<span id="cb42-527"><a href="#cb42-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-528"><a href="#cb42-528" aria-hidden="true" tabindex="-1"></a>Laureysens, I. et al. (2004) ‘Clonal variation in heavy metal accumulation and biomass production in a poplar coppice culture: I. Seasonal variation in leaf, wood and bark concentrations’, Environmental Pollution, 131(3), pp. 485–494. Available at: https://doi.org/10.1016/j.envpol.2004.02.009.</span>
<span id="cb42-529"><a href="#cb42-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-530"><a href="#cb42-530" aria-hidden="true" tabindex="-1"></a>Concentrations of aluminum (in micrograms of Al per gram of wood) are shown below.</span>
<span id="cb42-531"><a href="#cb42-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-532"><a href="#cb42-532" aria-hidden="true" tabindex="-1"></a>**Load packages**</span>
<span id="cb42-535"><a href="#cb42-535" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-536"><a href="#cb42-536" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (tidyverse)</span>
<span id="cb42-537"><a href="#cb42-537" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb42-538"><a href="#cb42-538" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot) <span class="co"># to make the plots look nice</span></span>
<span id="cb42-539"><a href="#cb42-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-540"><a href="#cb42-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-541"><a href="#cb42-541" aria-hidden="true" tabindex="-1"></a>**Load data**</span>
<span id="cb42-544"><a href="#cb42-544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-545"><a href="#cb42-545" aria-hidden="true" tabindex="-1"></a>filepath <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"poplars-paired_np.csv"</span>)</span>
<span id="cb42-546"><a href="#cb42-546" aria-hidden="true" tabindex="-1"></a>poplars <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(filepath,<span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-547"><a href="#cb42-547" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(poplars,<span class="dv">20</span>)</span>
<span id="cb42-548"><a href="#cb42-548" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-549"><a href="#cb42-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-550"><a href="#cb42-550" aria-hidden="true" tabindex="-1"></a>**Plot the  data**</span>
<span id="cb42-551"><a href="#cb42-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-552"><a href="#cb42-552" aria-hidden="true" tabindex="-1"></a>Before we do any test on some data to find evidence for a difference or a trend, it is a good idea to plot the data. This will reveal whatever patterns there are in the data and how likely they are to reveal a truth about the population from which they have been drawn.</span>
<span id="cb42-553"><a href="#cb42-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-554"><a href="#cb42-554" aria-hidden="true" tabindex="-1"></a>**Tidy the data**</span>
<span id="cb42-555"><a href="#cb42-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-556"><a href="#cb42-556" aria-hidden="true" tabindex="-1"></a>In this case there is work to do before we can plot the data. The problem is that the data is 'untidy'. The two levels of the factor <span class="in">`month`</span> are spread across two columns, August and November. For plotting purposes it will be useful to 'tidy' the data so that there is only one column containing both levels of <span class="in">`month`</span> and another containing the aluminium concentrations. The function <span class="in">`pivot_longer()`</span> can do this for us:</span>
<span id="cb42-557"><a href="#cb42-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-560"><a href="#cb42-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-561"><a href="#cb42-561" aria-hidden="true" tabindex="-1"></a>poplars_tidy <span class="ot">&lt;-</span> poplars <span class="sc">|&gt;</span></span>
<span id="cb42-562"><a href="#cb42-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span> (August<span class="sc">:</span>November,<span class="at">names_to=</span><span class="st">"month"</span>,<span class="at">values_to=</span><span class="st">"Al_conc"</span>)</span>
<span id="cb42-563"><a href="#cb42-563" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(poplars_tidy,<span class="dv">8</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-564"><a href="#cb42-564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span>
<span id="cb42-565"><a href="#cb42-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-566"><a href="#cb42-566" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-567"><a href="#cb42-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-568"><a href="#cb42-568" aria-hidden="true" tabindex="-1"></a>Now we can plot the data as a box plot, with one box for August and one for November ie one for each level of the factor <span class="in">`month`</span>. Had we not first tidied the data, we could not have done this.</span>
<span id="cb42-569"><a href="#cb42-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-572"><a href="#cb42-572" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-573"><a href="#cb42-573" aria-hidden="true" tabindex="-1"></a>poplars_tidy <span class="sc">|&gt;</span></span>
<span id="cb42-574"><a href="#cb42-574" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group = ID makes the lines join elements of each pair</span></span>
<span id="cb42-575"><a href="#cb42-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> Al_conc, <span class="at">fill =</span> month, <span class="at">colour =</span> month)) <span class="sc">+</span> </span>
<span id="cb42-576"><a href="#cb42-576" aria-hidden="true" tabindex="-1"></a>  <span class="co"># alpa (= opacity) &lt; 1 in case any points are on top of each other</span></span>
<span id="cb42-577"><a href="#cb42-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.size=</span><span class="dv">0</span>,<span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb42-578"><a href="#cb42-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb42-579"><a href="#cb42-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span>ID),<span class="at">colour =</span> <span class="st">"grey60"</span>) <span class="sc">+</span></span>
<span id="cb42-580"><a href="#cb42-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb42-581"><a href="#cb42-581" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Al conc.(mu g Al / g wood)"</span>) <span class="sc">+</span></span>
<span id="cb42-582"><a href="#cb42-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb42-583"><a href="#cb42-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb42-584"><a href="#cb42-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-585"><a href="#cb42-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-586"><a href="#cb42-586" aria-hidden="true" tabindex="-1"></a>Does it look as though the difference between the medians could plausibly be zero for the population? Or, put another way, if it was zero, how big a fluke would this sample be? That is what the p value actually tells us.</span>
<span id="cb42-587"><a href="#cb42-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-588"><a href="#cb42-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-589"><a href="#cb42-589" aria-hidden="true" tabindex="-1"></a><span class="fu">### Two sample paired t-test</span></span>
<span id="cb42-590"><a href="#cb42-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-591"><a href="#cb42-591" aria-hidden="true" tabindex="-1"></a>**Check for normality of differences**</span>
<span id="cb42-592"><a href="#cb42-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-593"><a href="#cb42-593" aria-hidden="true" tabindex="-1"></a>Before we use the t-test, we need to check that it is OK to do so. This means checking whether the paired differences are plausibly drawn from a normal distribution centred on zero. </span>
<span id="cb42-594"><a href="#cb42-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-595"><a href="#cb42-595" aria-hidden="true" tabindex="-1"></a>The null hypothesis of the Shapiro-Wilk test is that the data set given to it *is* drawn from a normally distributed population. So let us give our sample of paired differences:</span>
<span id="cb42-596"><a href="#cb42-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-599"><a href="#cb42-599" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-600"><a href="#cb42-600" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(poplars<span class="sc">$</span>August<span class="sc">-</span>poplars<span class="sc">$</span>November)</span>
<span id="cb42-601"><a href="#cb42-601" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-602"><a href="#cb42-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-603"><a href="#cb42-603" aria-hidden="true" tabindex="-1"></a>The p value is very high. Thus we do not reject the null hypothesis and we can reasonably assume that the differences between the August and November aluminium concentrations in the sample could plausibly have been drawn from a normally distributed population, despite the outlier value in the November sample. Thus we can reasonably test for difference using a paired t-test. </span>
<span id="cb42-604"><a href="#cb42-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-605"><a href="#cb42-605" aria-hidden="true" tabindex="-1"></a>**The actual t-test**</span>
<span id="cb42-606"><a href="#cb42-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-607"><a href="#cb42-607" aria-hidden="true" tabindex="-1"></a>We can do this in R using the function <span class="in">`t.test()`</span>, where we give to the function both the August and the November data, knowing that each August value has a counterpart November value, and we set the argument <span class="in">`paired`</span> to <span class="in">`TRUE`</span>.</span>
<span id="cb42-608"><a href="#cb42-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-611"><a href="#cb42-611" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-612"><a href="#cb42-612" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(poplars<span class="sc">$</span>August, poplars<span class="sc">$</span>November, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-613"><a href="#cb42-613" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-614"><a href="#cb42-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-615"><a href="#cb42-615" aria-hidden="true" tabindex="-1"></a>All parts of the output have meaning and are useful, but here we will focus on just two:</span>
<span id="cb42-616"><a href="#cb42-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-617"><a href="#cb42-617" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the p value is equal to 0.040. Hence, if we have chosen the usual significance value of 0.05, we can take this to mean that there is evidence of a significant difference between the August and November values.</span>
<span id="cb42-618"><a href="#cb42-618" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the lower and upper bounds of the 95\% confidence interval are (-9.52, -0.28). This tells us that if samples such as we have were collected again and again, then the mean difference between the August and the November paired values would be in this range 95\% of the time. The key thing is that this range does not encompass zero. This means that we can be confident at the 95% level that there is a non-zero change on going from August to November, and, in particular, that the August value is lower than the November value.</span>
<span id="cb42-619"><a href="#cb42-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-620"><a href="#cb42-620" aria-hidden="true" tabindex="-1"></a><span class="fu">## The non-parametric alternative: The Wilcoxon signed rank test</span></span>
<span id="cb42-621"><a href="#cb42-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-622"><a href="#cb42-622" aria-hidden="true" tabindex="-1"></a>To be safe, because of that outlier, let us test for difference using the Wilcoxon signed rank test. In R this is done using the function <span class="in">`wilcox.test()`</span>, with the argument <span class="in">`paired`</span> set to <span class="in">`TRUE`</span>.</span>
<span id="cb42-623"><a href="#cb42-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-626"><a href="#cb42-626" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-627"><a href="#cb42-627" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(poplars<span class="sc">$</span>August, poplars<span class="sc">$</span>November, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-628"><a href="#cb42-628" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-629"><a href="#cb42-629" aria-hidden="true" tabindex="-1"></a>We see that the conclusion (in this case) is the same.</span>
<span id="cb42-630"><a href="#cb42-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-631"><a href="#cb42-631" aria-hidden="true" tabindex="-1"></a><span class="fu">## Relation to one-sample paired test</span></span>
<span id="cb42-632"><a href="#cb42-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-633"><a href="#cb42-633" aria-hidden="true" tabindex="-1"></a>The two-sample paired tests as we have done above are the same as doing a one-sample test to see if the differences between the August and November paired values is different from zero. This is true whether we do a t-test or a Wilcoxon signed rank test.</span>
<span id="cb42-634"><a href="#cb42-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-637"><a href="#cb42-637" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-638"><a href="#cb42-638" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(poplars<span class="sc">$</span>August <span class="sc">-</span> poplars<span class="sc">$</span>November, <span class="at">mu =</span> <span class="dv">0</span>, <span class="at">data =</span> poplars)</span>
<span id="cb42-639"><a href="#cb42-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-640"><a href="#cb42-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-641"><a href="#cb42-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-644"><a href="#cb42-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-645"><a href="#cb42-645" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(poplars<span class="sc">$</span>August <span class="sc">-</span> poplars<span class="sc">$</span>November, <span class="at">mu =</span> <span class="dv">0</span>, <span class="at">data =</span> poplars)</span>
<span id="cb42-646"><a href="#cb42-646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-647"><a href="#cb42-647" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>